{"ast":null,"code":"import { decodeToken } from 'jsontokens';\nimport { BLOCKSTACK_HANDLER, getGlobalObject } from '@stacks/common';\nimport { createFetchFn } from '@stacks/network';\nexport function getAuthRequestFromURL() {\n  const location = getGlobalObject('location', {\n    throwIfUnavailable: true,\n    usageDesc: 'getAuthRequestFromURL'\n  });\n  const params = new URLSearchParams(location?.search);\n  return params.get('authRequest')?.replaceAll(`${BLOCKSTACK_HANDLER}:`, '') ?? null;\n}\nexport async function fetchAppManifest(authRequest, fetchFn = createFetchFn()) {\n  if (!authRequest) {\n    throw new Error('Invalid auth request');\n  }\n  const payload = decodeToken(authRequest).payload;\n  if (typeof payload === 'string') {\n    throw new Error('Unexpected token payload type of string');\n  }\n  const manifestURI = payload.manifest_uri;\n  try {\n    const response = await fetchFn(manifestURI);\n    const responseText = await response.text();\n    const responseJSON = JSON.parse(responseText);\n    return {\n      ...responseJSON,\n      manifestURI\n    };\n  } catch (error) {\n    console.log(error);\n    throw new Error('Could not fetch manifest.json');\n  }\n}","map":{"version":3,"names":["decodeToken","BLOCKSTACK_HANDLER","getGlobalObject","createFetchFn","getAuthRequestFromURL","location","throwIfUnavailable","usageDesc","params","URLSearchParams","search","get","replaceAll","fetchAppManifest","authRequest","fetchFn","Error","payload","manifestURI","manifest_uri","response","responseText","text","responseJSON","JSON","parse","error","console","log"],"sources":["C:\\Users\\Pedro\\ADAD2324\\frontend\\node_modules\\@stacks\\auth\\src\\provider.ts"],"sourcesContent":["import { decodeToken } from 'jsontokens';\r\nimport { BLOCKSTACK_HANDLER, getGlobalObject } from '@stacks/common';\r\nimport { createFetchFn, FetchFn } from '@stacks/network';\r\n\r\n/**\r\n * Retrieves the authentication request from the query string\r\n * @return {String|null} the authentication request or `null` if\r\n * the query string parameter `authRequest` is not found\r\n * @private\r\n * @ignore\r\n */\r\nexport function getAuthRequestFromURL(): string | null {\r\n  const location = getGlobalObject('location', {\r\n    throwIfUnavailable: true,\r\n    usageDesc: 'getAuthRequestFromURL',\r\n  });\r\n\r\n  const params = new URLSearchParams(location?.search);\r\n  return params.get('authRequest')?.replaceAll(`${BLOCKSTACK_HANDLER}:`, '') ?? null;\r\n}\r\n\r\n/**\r\n * Fetches the contents of the manifest file specified in the authentication request\r\n *\r\n * @param  {String} authRequest encoded and signed authentication request\r\n * @return {Promise<Object|String>} Returns a `Promise` that resolves to the JSON\r\n * object manifest file unless there's an error in which case rejects with an error\r\n * message.\r\n * @private\r\n * @ignore\r\n */\r\nexport async function fetchAppManifest(\r\n  authRequest: string,\r\n  fetchFn: FetchFn = createFetchFn()\r\n): Promise<any> {\r\n  if (!authRequest) {\r\n    throw new Error('Invalid auth request');\r\n  }\r\n  const payload = decodeToken(authRequest).payload;\r\n  if (typeof payload === 'string') {\r\n    throw new Error('Unexpected token payload type of string');\r\n  }\r\n  const manifestURI = payload.manifest_uri as string;\r\n  try {\r\n    // Logger.debug(`Fetching manifest from ${manifestURI}`)\r\n    const response = await fetchFn(manifestURI);\r\n    const responseText = await response.text();\r\n    const responseJSON = JSON.parse(responseText);\r\n    return { ...responseJSON, manifestURI };\r\n  } catch (error) {\r\n    console.log(error);\r\n    throw new Error('Could not fetch manifest.json');\r\n  }\r\n}\r\n"],"mappings":"AAAA,SAASA,WAAW,QAAQ,YAAY;AACxC,SAASC,kBAAkB,EAAEC,eAAe,QAAQ,gBAAgB;AACpE,SAASC,aAAa,QAAiB,iBAAiB;AASxD,OAAM,SAAUC,qBAAqBA,CAAA;EACnC,MAAMC,QAAQ,GAAGH,eAAe,CAAC,UAAU,EAAE;IAC3CI,kBAAkB,EAAE,IAAI;IACxBC,SAAS,EAAE;GACZ,CAAC;EAEF,MAAMC,MAAM,GAAG,IAAIC,eAAe,CAACJ,QAAQ,EAAEK,MAAM,CAAC;EACpD,OAAOF,MAAM,CAACG,GAAG,CAAC,aAAa,CAAC,EAAEC,UAAU,CAAC,GAAGX,kBAAkB,GAAG,EAAE,EAAE,CAAC,IAAI,IAAI;AACpF;AAYA,OAAO,eAAeY,gBAAgBA,CACpCC,WAAmB,EACnBC,OAAA,GAAmBZ,aAAa,EAAE;EAElC,IAAI,CAACW,WAAW,EAAE;IAChB,MAAM,IAAIE,KAAK,CAAC,sBAAsB,CAAC;;EAEzC,MAAMC,OAAO,GAAGjB,WAAW,CAACc,WAAW,CAAC,CAACG,OAAO;EAChD,IAAI,OAAOA,OAAO,KAAK,QAAQ,EAAE;IAC/B,MAAM,IAAID,KAAK,CAAC,yCAAyC,CAAC;;EAE5D,MAAME,WAAW,GAAGD,OAAO,CAACE,YAAsB;EAClD,IAAI;IAEF,MAAMC,QAAQ,GAAG,MAAML,OAAO,CAACG,WAAW,CAAC;IAC3C,MAAMG,YAAY,GAAG,MAAMD,QAAQ,CAACE,IAAI,EAAE;IAC1C,MAAMC,YAAY,GAAGC,IAAI,CAACC,KAAK,CAACJ,YAAY,CAAC;IAC7C,OAAO;MAAE,GAAGE,YAAY;MAAEL;IAAW,CAAE;GACxC,CAAC,OAAOQ,KAAK,EAAE;IACdC,OAAO,CAACC,GAAG,CAACF,KAAK,CAAC;IAClB,MAAM,IAAIV,KAAK,CAAC,+BAA+B,CAAC;;AAEpD"},"metadata":{},"sourceType":"module","externalDependencies":[]}