{"ast":null,"code":"// Disable no-var because we need to support old IE for now.\n/* eslint-disable no-var */\n// Disable space-before-function-paren for compatibility with VS Code default JS formatter.\n/* eslint-disable space-before-function-paren */\n\n/*\r\n * This module is intended to be executed both on client side and server side.\r\n * No error should be thrown. (soft error handling)\r\n */\n\n(function () {\n  var root = {};\n  // Dependencies --------------------------------------------------------------\n  root.async = typeof require === 'function' ? require('async') : window.async;\n  if (typeof root.async !== 'object') {\n    throw new Error('Module async is required (https://github.com/caolan/async)');\n  }\n  var async = root.async;\n  function _extend(origin, add) {\n    if (!add || typeof add !== 'object') {\n      return origin;\n    }\n    var keys = Object.keys(add);\n    var i = keys.length;\n    while (i--) {\n      origin[keys[i]] = add[keys[i]];\n    }\n    return origin;\n  }\n  function _merge() {\n    var ret = {};\n    var args = Array.prototype.slice.call(arguments);\n    var keys = null;\n    var i = null;\n    args.forEach(function (arg) {\n      if (arg && arg.constructor === Object) {\n        keys = Object.keys(arg);\n        i = keys.length;\n        while (i--) {\n          ret[keys[i]] = arg[keys[i]];\n        }\n      }\n    });\n    return ret;\n  }\n\n  // Customisable class (Base class) -------------------------------------------\n  // Use with operation \"new\" to extend Validation and Sanitization themselves,\n  // not their prototype. In other words, constructor shall be call to extend\n  // those functions, instead of being in their constructor, like this:\n  //   _extend(Validation, new Customisable);\n\n  function Customisable() {\n    this.custom = {};\n    this.extend = function (custom) {\n      return _extend(this.custom, custom);\n    };\n    this.reset = function () {\n      this.custom = {};\n    };\n    this.remove = function (fields) {\n      if (!_typeIs.array(fields)) {\n        fields = [fields];\n      }\n      fields.forEach(function (field) {\n        delete this.custom[field];\n      }, this);\n    };\n  }\n\n  // Inspection class (Base class) ---------------------------------------------\n  // Use to extend Validation and Sanitization prototypes. Inspection\n  // constructor shall be called in derived class constructor.\n\n  function Inspection(schema, custom) {\n    var _stack = ['@'];\n    this._schema = schema;\n    this._custom = {};\n    if (custom != null) {\n      for (var key in custom) {\n        if (Object.prototype.hasOwnProperty.call(custom, key)) {\n          this._custom['$' + key] = custom[key];\n        }\n      }\n    }\n    this._getDepth = function () {\n      return _stack.length;\n    };\n    this._dumpStack = function () {\n      /* eslint-disable no-control-regex */\n      return _stack.map(function (i) {\n        return i.replace(/^\\[/g, '\\u001b\\u001c\\u001d\\u001e');\n      }).join('.').replace(/\\.\\u001b\\u001c\\u001d\\u001e/g, '[');\n      /* eslint-enable no-control-regex */\n    };\n\n    this._deeperObject = function (name) {\n      _stack.push(/^[a-z$_][a-z0-9$_]*$/i.test(name) ? name : '[\"' + name + '\"]');\n      return this;\n    };\n    this._deeperArray = function (i) {\n      _stack.push('[' + i + ']');\n      return this;\n    };\n    this._back = function () {\n      _stack.pop();\n      return this;\n    };\n  }\n  // Simple types --------------------------------------------------------------\n  // If the property is not defined or is not in this list:\n  var _typeIs = {\n    function: function (element) {\n      return typeof element === 'function';\n    },\n    string: function (element) {\n      return typeof element === 'string';\n    },\n    number: function (element) {\n      return typeof element === 'number' && !isNaN(element);\n    },\n    integer: function (element) {\n      return typeof element === 'number' && element % 1 === 0;\n    },\n    NaN: function (element) {\n      return typeof element === 'number' && isNaN(element);\n    },\n    boolean: function (element) {\n      return typeof element === 'boolean';\n    },\n    null: function (element) {\n      return element === null;\n    },\n    date: function (element) {\n      return element != null && element instanceof Date;\n    },\n    object: function (element) {\n      return typeof element === 'object' && element != null && element.constructor !== Array;\n    },\n    array: function (element) {\n      return element != null && element.constructor === Array;\n    },\n    any: function () {\n      return true;\n    }\n  };\n  function _simpleType(type, candidate) {\n    if (typeof type === 'function') {\n      return candidate instanceof type;\n    }\n    type = type in _typeIs ? type : 'any';\n    return _typeIs[type](candidate);\n  }\n  function _realType(candidate) {\n    for (var i in _typeIs) {\n      if (_simpleType(i, candidate)) {\n        if (i !== 'any' && (i !== 'object' || candidate.constructor === Object)) {\n          return i;\n        }\n        return 'an instance of ' + candidate.constructor.name;\n      }\n    }\n  }\n  function getIndexes(a, value) {\n    var indexes = [];\n    var i = a.indexOf(value);\n    while (i !== -1) {\n      indexes.push(i);\n      i = a.indexOf(value, i + 1);\n    }\n    return indexes;\n  }\n\n  // Available formats ---------------------------------------------------------\n  /* eslint-disable no-useless-escape */\n  // TODO: Study these regex expressions and add more tests so we can consider removing\n  // rule no-useless-escape.\n  var _formats = {\n    void: /^$/,\n    url: /^(https?|ftp):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)?(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(\\#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$/i,\n    'date-time': /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?(Z?|(-|\\+)\\d{2}:\\d{2})$/,\n    date: /^\\d{4}-\\d{2}-\\d{2}$/,\n    coolDateTime: /^\\d{4}(-|\\/)\\d{2}(-|\\/)\\d{2}(T| )\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z?$/,\n    time: /^\\d{2}\\:\\d{2}\\:\\d{2}$/,\n    color: /^#([0-9a-f])+$/i,\n    // Very flexible regular expression designed to catch only obvious mistakes\n    // that a user might make that would have a 100% chance of causing email\n    // delivery to the address to fail. The library takes a flexible over\n    // strict approach. Users should use this only for basic front end email\n    // address validation and perform more strict checking using server-side\n    // code after the data has been sent to their server.\n    // Sourced from https://www.regular-expressions.info/email.html, modified\n    // to allow lowercase characters too.\n    email: /^[^@]+@[^.]+\\.[a-zA-Z]+$/,\n    /* eslint-enable prefer-regex-literals */\n    /* eslint-enable quotes */\n    numeric: /^[0-9]+$/,\n    integer: /^\\-?[0-9]+$/,\n    decimal: /^\\-?[0-9]*\\.?[0-9]+$/,\n    alpha: /^[a-z]+$/i,\n    alphaNumeric: /^[a-z0-9]+$/i,\n    alphaDash: /^[a-z0-9_-]+$/i,\n    javascript: /^[a-z_\\$][a-z0-9_\\$]*$/i,\n    upperString: /^[A-Z ]*$/,\n    lowerString: /^[a-z ]*$/,\n    v4uuid: /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}$/i\n  };\n  /* eslint-enable no-useless-escape */\n\n  // Validation ------------------------------------------------------------------\n  var _validationAttribut = {\n    optional: function (schema, candidate) {\n      var opt = typeof schema.optional === 'boolean' ? schema.optional : schema.optional === 'true'; // Default is false\n\n      if (opt === true) {\n        return;\n      }\n      if (typeof candidate === 'undefined') {\n        this.report('is missing and not optional', null, 'optional');\n      }\n    },\n    type: function (schema, candidate) {\n      // return because optional function already handle this case\n      if (typeof candidate === 'undefined' || typeof schema.type !== 'string' && !(schema.type instanceof Array) && typeof schema.type !== 'function') {\n        return;\n      }\n      var types = _typeIs.array(schema.type) ? schema.type : [schema.type];\n      var typeIsValid = types.some(function (type) {\n        return _simpleType(type, candidate);\n      });\n      if (!typeIsValid) {\n        types = types.map(function (t) {\n          return typeof t === 'function' ? 'an instance of ' + t.name : t;\n        });\n        this.report('must be ' + types.join(' or ') + ', but is ' + _realType(candidate), null, 'type');\n      }\n    },\n    uniqueness: function (schema, candidate) {\n      if (typeof schema.uniqueness === 'string') {\n        schema.uniqueness = schema.uniqueness === 'true';\n      }\n      if (typeof schema.uniqueness !== 'boolean' || schema.uniqueness === false || !_typeIs.array(candidate) && typeof candidate !== 'string') {\n        return;\n      }\n      var reported = [];\n      for (var i = 0; i < candidate.length; i++) {\n        if (reported.indexOf(candidate[i]) >= 0) {\n          continue;\n        }\n        var indexes = getIndexes(candidate, candidate[i]);\n        if (indexes.length > 1) {\n          reported.push(candidate[i]);\n          this.report('has value [' + candidate[i] + '] more than once at indexes [' + indexes.join(', ') + ']', null, 'uniqueness');\n        }\n      }\n    },\n    pattern: function (schema, candidate) {\n      var self = this;\n      var regexs = schema.pattern;\n      if (typeof candidate !== 'string') {\n        return;\n      }\n      var matches = false;\n      if (!_typeIs.array(regexs)) {\n        regexs = [regexs];\n      }\n      regexs.forEach(function (regex) {\n        if (typeof regex === 'string' && regex in _formats) {\n          regex = _formats[regex];\n        }\n        if (regex instanceof RegExp) {\n          if (regex.test(candidate)) {\n            matches = true;\n          }\n        }\n      });\n      if (!matches) {\n        self.report('must match [' + regexs.join(' or ') + '], but is equal to \"' + candidate + '\"', null, 'pattern');\n      }\n    },\n    validDate: function (schema, candidate) {\n      if (String(schema.validDate) === 'true' && candidate instanceof Date && isNaN(candidate.getTime())) {\n        this.report('must be a valid date', null, 'validDate');\n      }\n    },\n    minLength: function (schema, candidate) {\n      if (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\n        return;\n      }\n      var minLength = Number(schema.minLength);\n      if (isNaN(minLength)) {\n        return;\n      }\n      if (candidate.length < minLength) {\n        this.report('must be longer than ' + minLength + ' elements, but it has ' + candidate.length, null, 'minLength');\n      }\n    },\n    maxLength: function (schema, candidate) {\n      if (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\n        return;\n      }\n      var maxLength = Number(schema.maxLength);\n      if (isNaN(maxLength)) {\n        return;\n      }\n      if (candidate.length > maxLength) {\n        this.report('must be shorter than ' + maxLength + ' elements, but it has ' + candidate.length, null, 'maxLength');\n      }\n    },\n    exactLength: function (schema, candidate) {\n      if (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\n        return;\n      }\n      var exactLength = Number(schema.exactLength);\n      if (isNaN(exactLength)) {\n        return;\n      }\n      if (candidate.length !== exactLength) {\n        this.report('must have exactly ' + exactLength + ' elements, but it have ' + candidate.length, null, 'exactLength');\n      }\n    },\n    lt: function (schema, candidate) {\n      var limit = Number(schema.lt);\n      if (typeof candidate !== 'number' || isNaN(limit)) {\n        return;\n      }\n      if (candidate >= limit) {\n        this.report('must be less than ' + limit + ', but is equal to \"' + candidate + '\"', null, 'lt');\n      }\n    },\n    lte: function (schema, candidate) {\n      var limit = Number(schema.lte);\n      if (typeof candidate !== 'number' || isNaN(limit)) {\n        return;\n      }\n      if (candidate > limit) {\n        this.report('must be less than or equal to ' + limit + ', but is equal to \"' + candidate + '\"', null, 'lte');\n      }\n    },\n    gt: function (schema, candidate) {\n      var limit = Number(schema.gt);\n      if (typeof candidate !== 'number' || isNaN(limit)) {\n        return;\n      }\n      if (candidate <= limit) {\n        this.report('must be greater than ' + limit + ', but is equal to \"' + candidate + '\"', null, 'gt');\n      }\n    },\n    gte: function (schema, candidate) {\n      var limit = Number(schema.gte);\n      if (typeof candidate !== 'number' || isNaN(limit)) {\n        return;\n      }\n      if (candidate < limit) {\n        this.report('must be greater than or equal to ' + limit + ', but is equal to \"' + candidate + '\"', null, 'gte');\n      }\n    },\n    eq: function (schema, candidate) {\n      if (typeof candidate !== 'number' && typeof candidate !== 'string' && typeof candidate !== 'boolean') {\n        return;\n      }\n      var limit = schema.eq;\n      if (typeof limit !== 'number' && typeof limit !== 'string' && typeof limit !== 'boolean' && !_typeIs.array(limit)) {\n        return;\n      }\n      if (_typeIs.array(limit)) {\n        for (var i = 0; i < limit.length; i++) {\n          if (candidate === limit[i]) {\n            return;\n          }\n        }\n        this.report('must be equal to [' + limit.map(function (l) {\n          return '\"' + l + '\"';\n        }).join(' or ') + '], but is equal to \"' + candidate + '\"', null, 'eq');\n      } else {\n        if (candidate !== limit) {\n          this.report('must be equal to \"' + limit + '\", but is equal to \"' + candidate + '\"', null, 'eq');\n        }\n      }\n    },\n    ne: function (schema, candidate) {\n      if (typeof candidate !== 'number' && typeof candidate !== 'string') {\n        return;\n      }\n      var limit = schema.ne;\n      if (typeof limit !== 'number' && typeof limit !== 'string' && !_typeIs.array(limit)) {\n        return;\n      }\n      if (_typeIs.array(limit)) {\n        for (var i = 0; i < limit.length; i++) {\n          if (candidate === limit[i]) {\n            this.report('must not be equal to \"' + limit[i] + '\"', null, 'ne');\n            return;\n          }\n        }\n      } else {\n        if (candidate === limit) {\n          this.report('must not be equal to \"' + limit + '\"', null, 'ne');\n        }\n      }\n    },\n    multipleOf: function (schema, candidate) {\n      const divisor = Number(schema.multipleOf);\n      if (typeof candidate !== 'number' || isNaN(divisor)) {\n        return;\n      }\n      if (candidate % divisor !== 0) {\n        this.report(candidate + ' is not divisible by ' + divisor, null, 'multipleOf');\n      }\n    },\n    someKeys: function (schema, candidat) {\n      var _keys = schema.someKeys;\n      if (!_typeIs.object(candidat)) {\n        return;\n      }\n      var valid = _keys.some(function (action) {\n        return action in candidat;\n      });\n      if (!valid) {\n        this.report('must have at least key ' + _keys.map(function (i) {\n          return '\"' + i + '\"';\n        }).join(' or '), null, 'someKeys');\n      }\n    },\n    strict: function (schema, candidate) {\n      if (typeof schema.strict === 'string') {\n        schema.strict = schema.strict === 'true';\n      }\n      if (schema.strict !== true || !_typeIs.object(candidate) || !_typeIs.object(schema.properties)) {\n        return;\n      }\n      var self = this;\n      if (typeof schema.properties['*'] === 'undefined') {\n        var intruder = Object.keys(candidate).filter(function (key) {\n          return typeof schema.properties[key] === 'undefined';\n        });\n        if (intruder.length > 0) {\n          var msg = 'should not contains ' + (intruder.length > 1 ? 'properties' : 'property') + ' [' + intruder.map(function (i) {\n            return '\"' + i + '\"';\n          }).join(', ') + ']';\n          self.report(msg, null, 'strict');\n        }\n      }\n    },\n    exec: function (schema, candidate, callback) {\n      var self = this;\n      if (typeof callback === 'function') {\n        return this.asyncExec(schema, candidate, callback);\n      }\n      (_typeIs.array(schema.exec) ? schema.exec : [schema.exec]).forEach(function (exec) {\n        if (typeof exec === 'function') {\n          exec.call(self, schema, candidate);\n        }\n      });\n    },\n    properties: function (schema, candidate, callback) {\n      if (typeof callback === 'function') {\n        return this.asyncProperties(schema, candidate, callback);\n      }\n      if (!(schema.properties instanceof Object) || !(candidate instanceof Object)) {\n        return;\n      }\n      var properties = schema.properties;\n      var i;\n      if (properties['*'] != null) {\n        for (i in candidate) {\n          if (i in properties) {\n            continue;\n          }\n          this._deeperObject(i);\n          this._validate(properties['*'], candidate[i]);\n          this._back();\n        }\n      }\n      for (i in properties) {\n        if (i === '*') {\n          continue;\n        }\n        this._deeperObject(i);\n        this._validate(properties[i], candidate[i]);\n        this._back();\n      }\n    },\n    items: function (schema, candidate, callback) {\n      if (typeof callback === 'function') {\n        return this.asyncItems(schema, candidate, callback);\n      }\n      if (!(schema.items instanceof Object) || !(candidate instanceof Object)) {\n        return;\n      }\n      var items = schema.items;\n      var i, l;\n      // If provided schema is an array\n      // then call validate for each case\n      // else it is an Object\n      // then call validate for each key\n      if (_typeIs.array(items) && _typeIs.array(candidate)) {\n        for (i = 0, l = items.length; i < l; i++) {\n          this._deeperArray(i);\n          this._validate(items[i], candidate[i]);\n          this._back();\n        }\n      } else {\n        for (var key in candidate) {\n          if (Object.prototype.hasOwnProperty.call(candidate, key)) {\n            this._deeperArray(key);\n            this._validate(items, candidate[key]);\n            this._back();\n          }\n        }\n      }\n    }\n  };\n  var _asyncValidationAttribut = {\n    asyncExec: function (schema, candidate, callback) {\n      var self = this;\n      async.eachSeries(_typeIs.array(schema.exec) ? schema.exec : [schema.exec], function (exec, done) {\n        if (typeof exec === 'function') {\n          if (exec.length > 2) {\n            return exec.call(self, schema, candidate, done);\n          }\n          exec.call(self, schema, candidate);\n        }\n        async.nextTick(done);\n      }, callback);\n    },\n    asyncProperties: function (schema, candidate, callback) {\n      if (!(schema.properties instanceof Object) || !_typeIs.object(candidate)) {\n        return callback();\n      }\n      var self = this;\n      var properties = schema.properties;\n      async.series([function (next) {\n        if (properties['*'] == null) {\n          return next();\n        }\n        async.eachSeries(Object.keys(candidate), function (i, done) {\n          if (i in properties) {\n            return async.nextTick(done);\n          }\n          self._deeperObject(i);\n          self._asyncValidate(properties['*'], candidate[i], function (err) {\n            self._back();\n            done(err);\n          });\n        }, next);\n      }, function (next) {\n        async.eachSeries(Object.keys(properties), function (i, done) {\n          if (i === '*') {\n            return async.nextTick(done);\n          }\n          self._deeperObject(i);\n          self._asyncValidate(properties[i], candidate[i], function (err) {\n            self._back();\n            done(err);\n          });\n        }, next);\n      }], callback);\n    },\n    asyncItems: function (schema, candidate, callback) {\n      if (!(schema.items instanceof Object) || !(candidate instanceof Object)) {\n        return callback();\n      }\n      var self = this;\n      var items = schema.items;\n      if (_typeIs.array(items) && _typeIs.array(candidate)) {\n        async.timesSeries(items.length, function (i, done) {\n          self._deeperArray(i);\n          self._asyncValidate(items[i], candidate[i], function (err, res) {\n            self._back();\n            done(err, res);\n          });\n          self._back();\n        }, callback);\n      } else {\n        async.eachSeries(Object.keys(candidate), function (key, done) {\n          self._deeperArray(key);\n          self._asyncValidate(items, candidate[key], function (err, res) {\n            self._back();\n            done(err, res);\n          });\n        }, callback);\n      }\n    }\n  };\n\n  // Validation Class ----------------------------------------------------------\n  // inherits from Inspection class (actually we just call Inspection\n  // constructor with the new context, because its prototype is empty\n  function Validation(schema, custom) {\n    Inspection.prototype.constructor.call(this, schema, _merge(Validation.custom, custom));\n    var _error = [];\n    this._basicFields = Object.keys(_validationAttribut);\n    this._customFields = Object.keys(this._custom);\n    this.origin = null;\n    this.report = function (message, code, reason) {\n      var newErr = {\n        code: code || this.userCode || null,\n        reason: reason || 'unknown',\n        message: this.userError || message || 'is invalid',\n        property: this.userAlias ? this.userAlias + ' (' + this._dumpStack() + ')' : this._dumpStack()\n      };\n      _error.push(newErr);\n      return this;\n    };\n    this.result = function () {\n      return {\n        error: _error,\n        valid: _error.length === 0,\n        format: function () {\n          if (this.valid === true) {\n            return 'Candidate is valid';\n          }\n          return this.error.map(function (i) {\n            return 'Property ' + i.property + ': ' + i.message;\n          }).join('\\n');\n        }\n      };\n    };\n  }\n  _extend(Validation.prototype, _validationAttribut);\n  _extend(Validation.prototype, _asyncValidationAttribut);\n  _extend(Validation, new Customisable());\n  Validation.prototype.validate = function (candidate, callback) {\n    this.origin = candidate;\n    if (typeof callback === 'function') {\n      var self = this;\n      return async.nextTick(function () {\n        self._asyncValidate(self._schema, candidate, function (err) {\n          self.origin = null;\n          callback(err, self.result());\n        });\n      });\n    }\n    return this._validate(this._schema, candidate).result();\n  };\n  Validation.prototype._validate = function (schema, candidate, callback) {\n    this.userCode = schema.code || null;\n    this.userError = schema.error || null;\n    this.userAlias = schema.alias || null;\n    this._basicFields.forEach(function (i) {\n      if ((i in schema || i === 'optional') && typeof this[i] === 'function') {\n        this[i](schema, candidate);\n      }\n    }, this);\n    this._customFields.forEach(function (i) {\n      if (i in schema && typeof this._custom[i] === 'function') {\n        this._custom[i].call(this, schema, candidate);\n      }\n    }, this);\n    return this;\n  };\n  Validation.prototype._asyncValidate = function (schema, candidate, callback) {\n    var self = this;\n    this.userCode = schema.code || null;\n    this.userError = schema.error || null;\n    this.userAlias = schema.alias || null;\n    async.series([function (next) {\n      async.eachSeries(Object.keys(_validationAttribut), function (i, done) {\n        async.nextTick(function () {\n          if ((i in schema || i === 'optional') && typeof self[i] === 'function') {\n            if (self[i].length > 2) {\n              return self[i](schema, candidate, done);\n            }\n            self[i](schema, candidate);\n          }\n          done();\n        });\n      }, next);\n    }, function (next) {\n      async.eachSeries(Object.keys(self._custom), function (i, done) {\n        async.nextTick(function () {\n          if (i in schema && typeof self._custom[i] === 'function') {\n            if (self._custom[i].length > 2) {\n              return self._custom[i].call(self, schema, candidate, done);\n            }\n            self._custom[i].call(self, schema, candidate);\n          }\n          done();\n        });\n      }, next);\n    }], callback);\n  };\n\n  // Sanitization ----------------------------------------------------------------\n  // functions called by _sanitization.type method.\n  var _forceType = {\n    number: function (post, schema) {\n      var n;\n      if (typeof post === 'number') {\n        return post;\n      } else if (post === '') {\n        if (typeof schema.def !== 'undefined') {\n          return schema.def;\n        }\n        return null;\n      } else if (typeof post === 'string') {\n        n = parseFloat(post.replace(/,/g, '.').replace(/ /g, ''));\n        if (typeof n === 'number') {\n          return n;\n        }\n      } else if (post instanceof Date) {\n        return +post;\n      }\n      return null;\n    },\n    integer: function (post, schema) {\n      var n;\n      if (typeof post === 'number' && post % 1 === 0) {\n        return post;\n      } else if (post === '') {\n        if (typeof schema.def !== 'undefined') {\n          return schema.def;\n        }\n        return null;\n      } else if (typeof post === 'string') {\n        n = parseInt(post.replace(/ /g, ''), 10);\n        if (typeof n === 'number') {\n          return n;\n        }\n      } else if (typeof post === 'number') {\n        return parseInt(post, 10);\n      } else if (typeof post === 'boolean') {\n        if (post) {\n          return 1;\n        }\n        return 0;\n      } else if (post instanceof Date) {\n        return +post;\n      }\n      return null;\n    },\n    string: function (post, schema) {\n      if (typeof post === 'boolean' || typeof post === 'number' || post instanceof Date) {\n        return post.toString();\n      } else if (_typeIs.array(post)) {\n        // If user authorize array and strings...\n        if (schema.items || schema.properties) {\n          return post;\n        }\n        return post.join(String(schema.joinWith || ','));\n      } else if (post instanceof Object) {\n        // If user authorize objects ans strings...\n        if (schema.items || schema.properties) {\n          return post;\n        }\n        return JSON.stringify(post);\n      } else if (typeof post === 'string' && post.length) {\n        return post;\n      }\n      return null;\n    },\n    date: function (post, schema) {\n      if (post instanceof Date) {\n        return post;\n      } else {\n        var d = new Date(post);\n        if (!isNaN(d.getTime())) {\n          // if valid date\n          return d;\n        }\n      }\n      return null;\n    },\n    boolean: function (post, schema) {\n      if (typeof post === 'undefined') return null;\n      if (typeof post === 'string' && post.toLowerCase() === 'false') return false;\n      return !!post;\n    },\n    object: function (post, schema) {\n      if (typeof post !== 'string' || _typeIs.object(post)) {\n        return post;\n      }\n      try {\n        return JSON.parse(post);\n      } catch (e) {\n        return null;\n      }\n    },\n    array: function (post, schema) {\n      if (_typeIs.array(post)) {\n        return post;\n      }\n      if (typeof post === 'undefined') {\n        return null;\n      }\n      if (typeof post === 'string') {\n        if (post.substring(0, 1) === '[' && post.slice(-1) === ']') {\n          try {\n            return JSON.parse(post);\n          } catch (e) {\n            return null;\n          }\n        }\n        return post.split(String(schema.splitWith || ','));\n      }\n      if (!_typeIs.array(post)) {\n        return [post];\n      }\n      return null;\n    }\n  };\n  var _applyRules = {\n    upper: function (post) {\n      return post.toUpperCase();\n    },\n    lower: function (post) {\n      return post.toLowerCase();\n    },\n    title: function (post) {\n      // Fix by seb (replace \\w\\S* by \\S* => exemple : coucou Ã§a va)\n      return post.replace(/\\S*/g, function (txt) {\n        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\n      });\n    },\n    capitalize: function (post) {\n      return post.charAt(0).toUpperCase() + post.substr(1).toLowerCase();\n    },\n    ucfirst: function (post) {\n      return post.charAt(0).toUpperCase() + post.substr(1);\n    },\n    trim: function (post) {\n      return post.trim();\n    }\n  };\n\n  // Every function return the future value of each property. Therefore you\n  // have to return post even if you do not change its value\n  var _sanitizationAttribut = {\n    strict: function (schema, post) {\n      if (typeof schema.strict === 'string') {\n        schema.strict = schema.strict === 'true';\n      }\n      if (schema.strict !== true) {\n        return post;\n      }\n      if (!_typeIs.object(schema.properties)) {\n        return post;\n      }\n      if (!_typeIs.object(post)) {\n        return post;\n      }\n      Object.keys(post).forEach(function (key) {\n        if (!(key in schema.properties)) {\n          delete post[key];\n        }\n      });\n      return post;\n    },\n    optional: function (schema, post) {\n      var opt = typeof schema.optional === 'boolean' ? schema.optional : schema.optional !== 'false'; // Default: true\n      if (opt === true) {\n        return post;\n      }\n      if (typeof post !== 'undefined') {\n        return post;\n      }\n      this.report();\n      if (schema.def === Date) {\n        return new Date();\n      }\n      return schema.def;\n    },\n    type: function (schema, post) {\n      // if (_typeIs['object'](post) || _typeIs.array(post)) {\n      //   return post;\n      // }\n      if (typeof schema.type !== 'string' || typeof _forceType[schema.type] !== 'function') {\n        return post;\n      }\n      var n;\n      var opt = typeof schema.optional === 'boolean' ? schema.optional : true;\n      if (typeof _forceType[schema.type] === 'function') {\n        n = _forceType[schema.type](post, schema);\n        if (n === null && !opt || !n && isNaN(n) || n === null && schema.type === 'string') {\n          n = schema.def;\n        }\n      } else if (!opt) {\n        n = schema.def;\n      }\n      if ((n != null || typeof schema.def !== 'undefined' && schema.def === n) && n !== post) {\n        this.report();\n        return n;\n      }\n      return post;\n    },\n    rules: function (schema, post) {\n      var rules = schema.rules;\n      if (typeof post !== 'string' || typeof rules !== 'string' && !_typeIs.array(rules)) {\n        return post;\n      }\n      var modified = false;\n      (_typeIs.array(rules) ? rules : [rules]).forEach(function (rule) {\n        if (typeof _applyRules[rule] === 'function') {\n          post = _applyRules[rule](post);\n          modified = true;\n        }\n      });\n      if (modified) {\n        this.report();\n      }\n      return post;\n    },\n    min: function (schema, post) {\n      var postTest = Number(post);\n      if (isNaN(postTest)) {\n        return post;\n      }\n      var min = Number(schema.min);\n      if (isNaN(min)) {\n        return post;\n      }\n      if (postTest < min) {\n        this.report();\n        return min;\n      }\n      return post;\n    },\n    max: function (schema, post) {\n      var postTest = Number(post);\n      if (isNaN(postTest)) {\n        return post;\n      }\n      var max = Number(schema.max);\n      if (isNaN(max)) {\n        return post;\n      }\n      if (postTest > max) {\n        this.report();\n        return max;\n      }\n      return post;\n    },\n    minLength: function (schema, post) {\n      var limit = Number(schema.minLength);\n      if (typeof post !== 'string' || isNaN(limit) || limit < 0) {\n        return post;\n      }\n      var str = '';\n      var gap = limit - post.length;\n      if (gap > 0) {\n        for (var i = 0; i < gap; i++) {\n          str += '-';\n        }\n        this.report();\n        return post + str;\n      }\n      return post;\n    },\n    maxLength: function (schema, post) {\n      var limit = Number(schema.maxLength);\n      if (typeof post !== 'string' || isNaN(limit) || limit < 0) {\n        return post;\n      }\n      if (post.length > limit) {\n        this.report();\n        return post.slice(0, limit);\n      }\n      return post;\n    },\n    properties: function (schema, post, callback) {\n      if (typeof callback === 'function') {\n        return this.asyncProperties(schema, post, callback);\n      }\n      if (!post || typeof post !== 'object') {\n        return post;\n      }\n      var properties = schema.properties;\n      var tmp;\n      var i;\n      if (typeof properties['*'] !== 'undefined') {\n        for (i in post) {\n          if (i in properties) {\n            continue;\n          }\n          this._deeperObject(i);\n          tmp = this._sanitize(properties['*'], post[i]);\n          if (typeof tmp !== 'undefined' || 'exec' in properties['*']) {\n            post[i] = tmp;\n          }\n          this._back();\n        }\n      }\n      for (i in properties) {\n        if (i !== '*') {\n          this._deeperObject(i);\n          tmp = this._sanitize(properties[i], post[i]);\n          if (typeof tmp !== 'undefined' || 'exec' in properties[i]) {\n            post[i] = tmp;\n          }\n          this._back();\n        }\n      }\n      return post;\n    },\n    items: function (schema, post, callback) {\n      if (typeof callback === 'function') {\n        return this.asyncItems(schema, post, callback);\n      }\n      if (!(schema.items instanceof Object) || !(post instanceof Object)) {\n        return post;\n      }\n      var i;\n      if (_typeIs.array(schema.items) && _typeIs.array(post)) {\n        var minLength = schema.items.length < post.length ? schema.items.length : post.length;\n        for (i = 0; i < minLength; i++) {\n          this._deeperArray(i);\n          post[i] = this._sanitize(schema.items[i], post[i]);\n          this._back();\n        }\n      } else {\n        for (i in post) {\n          if (Object.prototype.hasOwnProperty.call(post, i)) {\n            this._deeperArray(i);\n            post[i] = this._sanitize(schema.items, post[i]);\n            this._back();\n          }\n        }\n      }\n      return post;\n    },\n    exec: function (schema, post, callback) {\n      if (typeof callback === 'function') {\n        return this.asyncExec(schema, post, callback);\n      }\n      var execs = _typeIs.array(schema.exec) ? schema.exec : [schema.exec];\n      execs.forEach(function (exec) {\n        if (typeof exec === 'function') {\n          post = exec.call(this, schema, post);\n        }\n      }, this);\n      return post;\n    }\n  };\n  var _asyncSanitizationAttribut = {\n    asyncExec: function (schema, post, callback) {\n      var self = this;\n      var execs = _typeIs.array(schema.exec) ? schema.exec : [schema.exec];\n      async.eachSeries(execs, function (exec, done) {\n        if (typeof exec === 'function') {\n          if (exec.length > 2) {\n            return exec.call(self, schema, post, function (err, res) {\n              if (err) {\n                return done(err);\n              }\n              post = res;\n              done();\n            });\n          }\n          post = exec.call(self, schema, post);\n        }\n        done();\n      }, function (err) {\n        callback(err, post);\n      });\n    },\n    asyncProperties: function (schema, post, callback) {\n      if (!post || typeof post !== 'object') {\n        return callback(null, post);\n      }\n      var self = this;\n      var properties = schema.properties;\n      async.series([function (next) {\n        if (properties['*'] == null) {\n          return next();\n        }\n        var globing = properties['*'];\n        async.eachSeries(Object.keys(post), function (i, next) {\n          if (i in properties) {\n            return next();\n          }\n          self._deeperObject(i);\n          self._asyncSanitize(globing, post[i], function (err, res) {\n            if (err) {/* Error can safely be ignored here */}\n            if (typeof res !== 'undefined') {\n              post[i] = res;\n            }\n            self._back();\n            next();\n          });\n        }, next);\n      }, function (next) {\n        async.eachSeries(Object.keys(properties), function (i, next) {\n          if (i === '*') {\n            return next();\n          }\n          self._deeperObject(i);\n          self._asyncSanitize(properties[i], post[i], function (err, res) {\n            if (err) {\n              return next(err);\n            }\n            if (typeof res !== 'undefined') {\n              post[i] = res;\n            }\n            self._back();\n            next();\n          });\n        }, next);\n      }], function (err) {\n        return callback(err, post);\n      });\n    },\n    asyncItems: function (schema, post, callback) {\n      if (!(schema.items instanceof Object) || !(post instanceof Object)) {\n        return callback(null, post);\n      }\n      var self = this;\n      var items = schema.items;\n      if (_typeIs.array(items) && _typeIs.array(post)) {\n        var minLength = items.length < post.length ? items.length : post.length;\n        async.timesSeries(minLength, function (i, next) {\n          self._deeperArray(i);\n          self._asyncSanitize(items[i], post[i], function (err, res) {\n            if (err) {\n              return next(err);\n            }\n            post[i] = res;\n            self._back();\n            next();\n          });\n        }, function (err) {\n          callback(err, post);\n        });\n      } else {\n        async.eachSeries(Object.keys(post), function (key, next) {\n          self._deeperArray(key);\n          self._asyncSanitize(items, post[key], function (err, res) {\n            if (err) {\n              return next();\n            }\n            post[key] = res;\n            self._back();\n            next();\n          });\n        }, function (err) {\n          callback(err, post);\n        });\n      }\n      return post;\n    }\n  };\n\n  // Sanitization Class --------------------------------------------------------\n  // inherits from Inspection class (actually we just call Inspection\n  // constructor with the new context, because its prototype is empty\n  function Sanitization(schema, custom) {\n    Inspection.prototype.constructor.call(this, schema, _merge(Sanitization.custom, custom));\n    var _reporting = [];\n    this._basicFields = Object.keys(_sanitizationAttribut);\n    this._customFields = Object.keys(this._custom);\n    this.origin = null;\n    this.report = function (message) {\n      var newNot = {\n        message: message || 'was sanitized',\n        property: this.userAlias ? this.userAlias + ' (' + this._dumpStack() + ')' : this._dumpStack()\n      };\n      if (!_reporting.some(function (e) {\n        return e.property === newNot.property;\n      })) {\n        _reporting.push(newNot);\n      }\n    };\n    this.result = function (data) {\n      // For old IE.\n      /* eslint-disable object-shorthand */\n      return {\n        data: data,\n        reporting: _reporting,\n        format: function () {\n          return this.reporting.map(function (i) {\n            return 'Property ' + i.property + ' ' + i.message;\n          }).join('\\n');\n        }\n      };\n      /* eslint-enable object-shorthand */\n    };\n  }\n\n  _extend(Sanitization.prototype, _sanitizationAttribut);\n  _extend(Sanitization.prototype, _asyncSanitizationAttribut);\n  _extend(Sanitization, new Customisable());\n  Sanitization.prototype.sanitize = function (post, callback) {\n    this.origin = post;\n    if (typeof callback === 'function') {\n      var self = this;\n      return this._asyncSanitize(this._schema, post, function (err, data) {\n        self.origin = null;\n        callback(err, self.result(data));\n      });\n    }\n    var data = this._sanitize(this._schema, post);\n    this.origin = null;\n    return this.result(data);\n  };\n  Sanitization.prototype._sanitize = function (schema, post) {\n    this.userAlias = schema.alias || null;\n    this._basicFields.forEach(function (i) {\n      if ((i in schema || i === 'optional') && typeof this[i] === 'function') {\n        post = this[i](schema, post);\n      }\n    }, this);\n    this._customFields.forEach(function (i) {\n      if (i in schema && typeof this._custom[i] === 'function') {\n        post = this._custom[i].call(this, schema, post);\n      }\n    }, this);\n    return post;\n  };\n  Sanitization.prototype._asyncSanitize = function (schema, post, callback) {\n    var self = this;\n    this.userAlias = schema.alias || null;\n    async.waterfall([function (next) {\n      async.reduce(self._basicFields, post, function (value, i, next) {\n        async.nextTick(function () {\n          if ((i in schema || i === 'optional') && typeof self[i] === 'function') {\n            if (self[i].length > 2) {\n              return self[i](schema, value, next);\n            }\n            value = self[i](schema, value);\n          }\n          next(null, value);\n        });\n      }, next);\n    }, function (inter, next) {\n      async.reduce(self._customFields, inter, function (value, i, next) {\n        async.nextTick(function () {\n          if (i in schema && typeof self._custom[i] === 'function') {\n            if (self._custom[i].length > 2) {\n              return self._custom[i].call(self, schema, value, next);\n            }\n            value = self._custom[i].call(self, schema, value);\n          }\n          next(null, value);\n        });\n      }, next);\n    }], callback);\n  };\n\n  // ---------------------------------------------------------------------------\n\n  var INT_MIN = -2147483648;\n  var INT_MAX = 2147483647;\n  var _rand = {\n    int: function (min, max) {\n      return min + (0 | Math.random() * (max - min + 1));\n    },\n    float: function (min, max) {\n      return Math.random() * (max - min) + min;\n    },\n    bool: function () {\n      return Math.random() > 0.5;\n    },\n    char: function (min, max) {\n      return String.fromCharCode(this.int(min, max));\n    },\n    fromList: function (list) {\n      return list[this.int(0, list.length - 1)];\n    }\n  };\n  var _formatSample = {\n    'date-time': function () {\n      return new Date().toISOString();\n    },\n    date: function () {\n      return new Date().toISOString().replace(/T.*$/, '');\n    },\n    time: function () {\n      return new Date().toLocaleTimeString({}, {\n        hour12: false\n      });\n    },\n    color: function (min, max) {\n      var s = '#';\n      if (min < 1) {\n        min = 1;\n      }\n      for (var i = 0, l = _rand.int(min, max); i < l; i++) {\n        s += _rand.fromList('0123456789abcdefABCDEF');\n      }\n      return s;\n    },\n    numeric: function () {\n      return '' + _rand.int(0, INT_MAX);\n    },\n    integer: function () {\n      if (_rand.bool() === true) {\n        return '-' + this.numeric();\n      }\n      return this.numeric();\n    },\n    decimal: function () {\n      return this.integer() + '.' + this.numeric();\n    },\n    alpha: function (min, max) {\n      var s = '';\n      if (min < 1) {\n        min = 1;\n      }\n      for (var i = 0, l = _rand.int(min, max); i < l; i++) {\n        s += _rand.fromList('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ');\n      }\n      return s;\n    },\n    alphaNumeric: function (min, max) {\n      var s = '';\n      if (min < 1) {\n        min = 1;\n      }\n      for (var i = 0, l = _rand.int(min, max); i < l; i++) {\n        s += _rand.fromList('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789');\n      }\n      return s;\n    },\n    alphaDash: function (min, max) {\n      var s = '';\n      if (min < 1) {\n        min = 1;\n      }\n      for (var i = 0, l = _rand.int(min, max); i < l; i++) {\n        s += _rand.fromList('_-abcdefghijklmnopqrstuvwxyz_-ABCDEFGHIJKLMNOPQRSTUVWXYZ_-0123456789_-');\n      }\n      return s;\n    },\n    javascript: function (min, max) {\n      var s = _rand.fromList('_$abcdefghijklmnopqrstuvwxyz_$ABCDEFGHIJKLMNOPQRSTUVWXYZ_$');\n      for (var i = 0, l = _rand.int(min, max - 1); i < l; i++) {\n        s += _rand.fromList('_$abcdefghijklmnopqrstuvwxyz_$ABCDEFGHIJKLMNOPQRSTUVWXYZ_$0123456789_$');\n      }\n      return s;\n    }\n  };\n  function _getLimits(schema) {\n    var min = INT_MIN;\n    var max = INT_MAX;\n    if (schema.gte != null) {\n      min = schema.gte;\n    } else if (schema.gt != null) {\n      min = schema.gt + 1;\n    }\n    if (schema.lte != null) {\n      max = schema.lte;\n    } else if (schema.lt != null) {\n      max = schema.lt - 1;\n    }\n    // For old IE.\n    /* eslint-disable object-shorthand */\n    return {\n      min: min,\n      max: max\n    };\n    /* eslint-enable object-shorthand */\n  }\n\n  var _typeGenerator = {\n    string: function (schema) {\n      if (schema.eq != null) {\n        return schema.eq;\n      }\n      var s = '';\n      var minLength = schema.minLength != null ? schema.minLength : 0;\n      var maxLength = schema.maxLength != null ? schema.maxLength : 32;\n      if (typeof schema.pattern === 'string' && typeof _formatSample[schema.pattern] === 'function') {\n        return _formatSample[schema.pattern](minLength, maxLength);\n      }\n      var l = schema.exactLength != null ? schema.exactLength : _rand.int(minLength, maxLength);\n      for (var i = 0; i < l; i++) {\n        s += _rand.char(32, 126);\n      }\n      return s;\n    },\n    number: function (schema) {\n      if (schema.eq != null) {\n        return schema.eq;\n      }\n      var limit = _getLimits(schema);\n      var n = _rand.float(limit.min, limit.max);\n      if (schema.ne != null) {\n        var ne = _typeIs.array(schema.ne) ? schema.ne : [schema.ne];\n        while (ne.indexOf(n) !== -1) {\n          n = _rand.float(limit.min, limit.max);\n        }\n      }\n      return n;\n    },\n    integer: function (schema) {\n      if (schema.eq != null) {\n        return schema.eq;\n      }\n      var limit = _getLimits(schema);\n      var n = _rand.int(limit.min, limit.max);\n      if (schema.ne != null) {\n        var ne = _typeIs.array(schema.ne) ? schema.ne : [schema.ne];\n        while (ne.indexOf(n) !== -1) {\n          n = _rand.int(limit.min, limit.max);\n        }\n      }\n      return n;\n    },\n    boolean: function (schema) {\n      if (schema.eq != null) {\n        return schema.eq;\n      }\n      return _rand.bool();\n    },\n    null: function (schema) {\n      return null;\n    },\n    date: function (schema) {\n      if (schema.eq != null) {\n        return schema.eq;\n      }\n      return new Date();\n    },\n    object: function (schema) {\n      var o = {};\n      var prop = schema.properties || {};\n      for (var key in prop) {\n        if (Object.prototype.hasOwnProperty.call(prop, key)) {\n          if (prop[key].optional === true && _rand.bool() === true) {\n            continue;\n          }\n          if (key !== '*') {\n            o[key] = this.generate(prop[key]);\n          } else {\n            var rk = '__random_key_';\n            var randomKey = rk + 0;\n            var n = _rand.int(1, 9);\n            for (var i = 1; i <= n; i++) {\n              if (!(randomKey in prop)) {\n                o[randomKey] = this.generate(prop[key]);\n              }\n              randomKey = rk + i;\n            }\n          }\n        }\n      }\n      return o;\n    },\n    array: function (schema) {\n      var self = this;\n      var items = schema.items || {};\n      var minLength = schema.minLength != null ? schema.minLength : 0;\n      var maxLength = schema.maxLength != null ? schema.maxLength : 16;\n      var type;\n      var candidate;\n      var size;\n      var i;\n      if (_typeIs.array(items)) {\n        size = items.length;\n        if (schema.exactLength != null) {\n          size = schema.exactLength;\n        } else if (size < minLength) {\n          size = minLength;\n        } else if (size > maxLength) {\n          size = maxLength;\n        }\n        candidate = new Array(size);\n        type = null;\n        for (i = 0; i < size; i++) {\n          type = items[i].type || 'any';\n          if (_typeIs.array(type)) {\n            type = type[_rand.int(0, type.length - 1)];\n          }\n          candidate[i] = self[type](items[i]);\n        }\n      } else {\n        size = schema.exactLength != null ? schema.exactLength : _rand.int(minLength, maxLength);\n        candidate = new Array(size);\n        type = items.type || 'any';\n        if (_typeIs.array(type)) {\n          type = type[_rand.int(0, type.length - 1)];\n        }\n        for (i = 0; i < size; i++) {\n          candidate[i] = self[type](items);\n        }\n      }\n      return candidate;\n    },\n    any: function (schema) {\n      var fields = Object.keys(_typeGenerator);\n      var i = fields[_rand.int(0, fields.length - 2)];\n      return this[i](schema);\n    }\n  };\n\n  // CandidateGenerator Class (Singleton) --------------------------------------\n  function CandidateGenerator() {\n    // Maybe extends Inspection class too ?\n  }\n  _extend(CandidateGenerator.prototype, _typeGenerator);\n  var _instance = null;\n  CandidateGenerator.instance = function () {\n    if (!(_instance instanceof CandidateGenerator)) {\n      _instance = new CandidateGenerator();\n    }\n    return _instance;\n  };\n  CandidateGenerator.prototype.generate = function (schema) {\n    var type = schema.type || 'any';\n    if (_typeIs.array(type)) {\n      type = type[_rand.int(0, type.length - 1)];\n    }\n    return this[type](schema);\n  };\n\n  // Exports ---------------------------------------------------------------------\n  var SchemaInspector = {};\n\n  // if server-side (node.js) else client-side\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = SchemaInspector;\n  } else {\n    window.SchemaInspector = SchemaInspector;\n  }\n  SchemaInspector.newSanitization = function (schema, custom) {\n    return new Sanitization(schema, custom);\n  };\n  SchemaInspector.newValidation = function (schema, custom) {\n    return new Validation(schema, custom);\n  };\n  SchemaInspector.Validation = Validation;\n  SchemaInspector.Sanitization = Sanitization;\n  SchemaInspector.sanitize = function (schema, post, custom, callback) {\n    if (arguments.length === 3 && typeof custom === 'function') {\n      callback = custom;\n      custom = null;\n    }\n    return new Sanitization(schema, custom).sanitize(post, callback);\n  };\n  SchemaInspector.validate = function (schema, candidate, custom, callback) {\n    if (arguments.length === 3 && typeof custom === 'function') {\n      callback = custom;\n      custom = null;\n    }\n    return new Validation(schema, custom).validate(candidate, callback);\n  };\n  SchemaInspector.generate = function (schema, n) {\n    if (typeof n === 'number') {\n      var r = new Array(n);\n      for (var i = 0; i < n; i++) {\n        r[i] = CandidateGenerator.instance().generate(schema);\n      }\n      return r;\n    }\n    return CandidateGenerator.instance().generate(schema);\n  };\n})();","map":{"version":3,"names":["root","async","require","window","Error","_extend","origin","add","keys","Object","i","length","_merge","ret","args","Array","prototype","slice","call","arguments","forEach","arg","constructor","Customisable","custom","extend","reset","remove","fields","_typeIs","array","field","Inspection","schema","_stack","_schema","_custom","key","hasOwnProperty","_getDepth","_dumpStack","map","replace","join","_deeperObject","name","push","test","_deeperArray","_back","pop","function","element","string","number","isNaN","integer","NaN","boolean","null","date","Date","object","any","_simpleType","type","candidate","_realType","getIndexes","a","value","indexes","indexOf","_formats","void","url","coolDateTime","time","color","email","numeric","decimal","alpha","alphaNumeric","alphaDash","javascript","upperString","lowerString","v4uuid","_validationAttribut","optional","opt","report","types","typeIsValid","some","t","uniqueness","reported","pattern","self","regexs","matches","regex","RegExp","validDate","String","getTime","minLength","Number","maxLength","exactLength","lt","limit","lte","gt","gte","eq","l","ne","multipleOf","divisor","someKeys","candidat","_keys","valid","action","strict","properties","intruder","filter","msg","exec","callback","asyncExec","asyncProperties","_validate","items","asyncItems","_asyncValidationAttribut","eachSeries","done","nextTick","series","next","_asyncValidate","err","timesSeries","res","Validation","_error","_basicFields","_customFields","message","code","reason","newErr","userCode","userError","property","userAlias","result","error","format","validate","alias","_forceType","post","n","def","parseFloat","parseInt","toString","joinWith","JSON","stringify","d","toLowerCase","parse","e","substring","split","splitWith","_applyRules","upper","toUpperCase","lower","title","txt","charAt","substr","capitalize","ucfirst","trim","_sanitizationAttribut","rules","modified","rule","min","postTest","max","str","gap","tmp","_sanitize","execs","_asyncSanitizationAttribut","globing","_asyncSanitize","Sanitization","_reporting","newNot","data","reporting","sanitize","waterfall","reduce","inter","INT_MIN","INT_MAX","_rand","int","Math","random","float","bool","char","fromCharCode","fromList","list","_formatSample","date-time","toISOString","toLocaleTimeString","hour12","s","_getLimits","_typeGenerator","o","prop","generate","rk","randomKey","size","CandidateGenerator","_instance","instance","SchemaInspector","module","exports","newSanitization","newValidation","r"],"sources":["C:/Users/Pedro/ADAD2324/frontend/node_modules/schema-inspector/lib/schema-inspector.js"],"sourcesContent":["// Disable no-var because we need to support old IE for now.\r\n/* eslint-disable no-var */\r\n// Disable space-before-function-paren for compatibility with VS Code default JS formatter.\r\n/* eslint-disable space-before-function-paren */\r\n\r\n/*\r\n * This module is intended to be executed both on client side and server side.\r\n * No error should be thrown. (soft error handling)\r\n */\r\n\r\n(function () {\r\n  var root = {};\r\n  // Dependencies --------------------------------------------------------------\r\n  root.async = (typeof require === 'function') ? require('async') : window.async;\r\n  if (typeof root.async !== 'object') {\r\n    throw new Error('Module async is required (https://github.com/caolan/async)');\r\n  }\r\n  var async = root.async;\r\n\r\n  function _extend(origin, add) {\r\n    if (!add || typeof add !== 'object') {\r\n      return origin;\r\n    }\r\n    var keys = Object.keys(add);\r\n    var i = keys.length;\r\n    while (i--) {\r\n      origin[keys[i]] = add[keys[i]];\r\n    }\r\n    return origin;\r\n  }\r\n\r\n  function _merge() {\r\n    var ret = {};\r\n    var args = Array.prototype.slice.call(arguments);\r\n    var keys = null;\r\n    var i = null;\r\n\r\n    args.forEach(function (arg) {\r\n      if (arg && arg.constructor === Object) {\r\n        keys = Object.keys(arg);\r\n        i = keys.length;\r\n        while (i--) {\r\n          ret[keys[i]] = arg[keys[i]];\r\n        }\r\n      }\r\n    });\r\n    return ret;\r\n  }\r\n\r\n  // Customisable class (Base class) -------------------------------------------\r\n  // Use with operation \"new\" to extend Validation and Sanitization themselves,\r\n  // not their prototype. In other words, constructor shall be call to extend\r\n  // those functions, instead of being in their constructor, like this:\r\n  //   _extend(Validation, new Customisable);\r\n\r\n  function Customisable() {\r\n    this.custom = {};\r\n\r\n    this.extend = function (custom) {\r\n      return _extend(this.custom, custom);\r\n    };\r\n\r\n    this.reset = function () {\r\n      this.custom = {};\r\n    };\r\n\r\n    this.remove = function (fields) {\r\n      if (!_typeIs.array(fields)) {\r\n        fields = [fields];\r\n      }\r\n      fields.forEach(function (field) {\r\n        delete this.custom[field];\r\n      }, this);\r\n    };\r\n  }\r\n\r\n  // Inspection class (Base class) ---------------------------------------------\r\n  // Use to extend Validation and Sanitization prototypes. Inspection\r\n  // constructor shall be called in derived class constructor.\r\n\r\n  function Inspection(schema, custom) {\r\n    var _stack = ['@'];\r\n\r\n    this._schema = schema;\r\n    this._custom = {};\r\n    if (custom != null) {\r\n      for (var key in custom) {\r\n        if (Object.prototype.hasOwnProperty.call(custom, key)) {\r\n          this._custom['$' + key] = custom[key];\r\n        }\r\n      }\r\n    }\r\n\r\n    this._getDepth = function () {\r\n      return _stack.length;\r\n    };\r\n\r\n    this._dumpStack = function () {\r\n      /* eslint-disable no-control-regex */\r\n      return _stack.map(function (i) { return i.replace(/^\\[/g, '\\u001b\\u001c\\u001d\\u001e'); })\r\n        .join('.').replace(/\\.\\u001b\\u001c\\u001d\\u001e/g, '[');\r\n      /* eslint-enable no-control-regex */\r\n    };\r\n\r\n    this._deeperObject = function (name) {\r\n      _stack.push((/^[a-z$_][a-z0-9$_]*$/i).test(name) ? name : '[\"' + name + '\"]');\r\n      return this;\r\n    };\r\n\r\n    this._deeperArray = function (i) {\r\n      _stack.push('[' + i + ']');\r\n      return this;\r\n    };\r\n\r\n    this._back = function () {\r\n      _stack.pop();\r\n      return this;\r\n    };\r\n  }\r\n  // Simple types --------------------------------------------------------------\r\n  // If the property is not defined or is not in this list:\r\n  var _typeIs = {\r\n    function: function (element) {\r\n      return typeof element === 'function';\r\n    },\r\n    string: function (element) {\r\n      return typeof element === 'string';\r\n    },\r\n    number: function (element) {\r\n      return typeof element === 'number' && !isNaN(element);\r\n    },\r\n    integer: function (element) {\r\n      return typeof element === 'number' && element % 1 === 0;\r\n    },\r\n    NaN: function (element) {\r\n      return typeof element === 'number' && isNaN(element);\r\n    },\r\n    boolean: function (element) {\r\n      return typeof element === 'boolean';\r\n    },\r\n    null: function (element) {\r\n      return element === null;\r\n    },\r\n    date: function (element) {\r\n      return element != null && element instanceof Date;\r\n    },\r\n    object: function (element) {\r\n      return typeof element === 'object' && element != null && element.constructor !== Array;\r\n    },\r\n    array: function (element) {\r\n      return element != null && element.constructor === Array;\r\n    },\r\n    any: function () {\r\n      return true;\r\n    }\r\n  };\r\n\r\n  function _simpleType(type, candidate) {\r\n    if (typeof type === 'function') {\r\n      return candidate instanceof type;\r\n    }\r\n    type = type in _typeIs ? type : 'any';\r\n    return _typeIs[type](candidate);\r\n  }\r\n\r\n  function _realType(candidate) {\r\n    for (var i in _typeIs) {\r\n      if (_simpleType(i, candidate)) {\r\n        if (i !== 'any' && (i !== 'object' || candidate.constructor === Object)) { return i; }\r\n        return 'an instance of ' + candidate.constructor.name;\r\n      }\r\n    }\r\n  }\r\n\r\n  function getIndexes(a, value) {\r\n    var indexes = [];\r\n    var i = a.indexOf(value);\r\n\r\n    while (i !== -1) {\r\n      indexes.push(i);\r\n      i = a.indexOf(value, i + 1);\r\n    }\r\n    return indexes;\r\n  }\r\n\r\n  // Available formats ---------------------------------------------------------\r\n  /* eslint-disable no-useless-escape */\r\n  // TODO: Study these regex expressions and add more tests so we can consider removing\r\n  // rule no-useless-escape.\r\n  var _formats = {\r\n    void: /^$/,\r\n    url: /^(https?|ftp):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)?(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(\\#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$/i,\r\n    'date-time': /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?(Z?|(-|\\+)\\d{2}:\\d{2})$/,\r\n    date: /^\\d{4}-\\d{2}-\\d{2}$/,\r\n    coolDateTime: /^\\d{4}(-|\\/)\\d{2}(-|\\/)\\d{2}(T| )\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z?$/,\r\n    time: /^\\d{2}\\:\\d{2}\\:\\d{2}$/,\r\n    color: /^#([0-9a-f])+$/i,\r\n    // Very flexible regular expression designed to catch only obvious mistakes\r\n    // that a user might make that would have a 100% chance of causing email\r\n    // delivery to the address to fail. The library takes a flexible over\r\n    // strict approach. Users should use this only for basic front end email\r\n    // address validation and perform more strict checking using server-side\r\n    // code after the data has been sent to their server.\r\n    // Sourced from https://www.regular-expressions.info/email.html, modified\r\n    // to allow lowercase characters too.\r\n    email: /^[^@]+@[^.]+\\.[a-zA-Z]+$/,\r\n    /* eslint-enable prefer-regex-literals */\r\n    /* eslint-enable quotes */\r\n    numeric: /^[0-9]+$/,\r\n    integer: /^\\-?[0-9]+$/,\r\n    decimal: /^\\-?[0-9]*\\.?[0-9]+$/,\r\n    alpha: /^[a-z]+$/i,\r\n    alphaNumeric: /^[a-z0-9]+$/i,\r\n    alphaDash: /^[a-z0-9_-]+$/i,\r\n    javascript: /^[a-z_\\$][a-z0-9_\\$]*$/i,\r\n    upperString: /^[A-Z ]*$/,\r\n    lowerString: /^[a-z ]*$/,\r\n    v4uuid: /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}$/i\r\n  };\r\n  /* eslint-enable no-useless-escape */\r\n\r\n  // Validation ------------------------------------------------------------------\r\n  var _validationAttribut = {\r\n    optional: function (schema, candidate) {\r\n      var opt = typeof schema.optional === 'boolean' ? schema.optional : (schema.optional === 'true'); // Default is false\r\n\r\n      if (opt === true) {\r\n        return;\r\n      }\r\n      if (typeof candidate === 'undefined') {\r\n        this.report('is missing and not optional', null, 'optional');\r\n      }\r\n    },\r\n    type: function (schema, candidate) {\r\n      // return because optional function already handle this case\r\n      if (typeof candidate === 'undefined' || (typeof schema.type !== 'string' && !(schema.type instanceof Array) && typeof schema.type !== 'function')) {\r\n        return;\r\n      }\r\n      var types = _typeIs.array(schema.type) ? schema.type : [schema.type];\r\n      var typeIsValid = types.some(function (type) {\r\n        return _simpleType(type, candidate);\r\n      });\r\n      if (!typeIsValid) {\r\n        types = types.map(function (t) { return typeof t === 'function' ? 'an instance of ' + t.name : t; });\r\n        this.report('must be ' + types.join(' or ') + ', but is ' + _realType(candidate), null, 'type');\r\n      }\r\n    },\r\n    uniqueness: function (schema, candidate) {\r\n      if (typeof schema.uniqueness === 'string') { schema.uniqueness = (schema.uniqueness === 'true'); }\r\n      if (typeof schema.uniqueness !== 'boolean' || schema.uniqueness === false || (!_typeIs.array(candidate) && typeof candidate !== 'string')) {\r\n        return;\r\n      }\r\n      var reported = [];\r\n      for (var i = 0; i < candidate.length; i++) {\r\n        if (reported.indexOf(candidate[i]) >= 0) {\r\n          continue;\r\n        }\r\n        var indexes = getIndexes(candidate, candidate[i]);\r\n        if (indexes.length > 1) {\r\n          reported.push(candidate[i]);\r\n          this.report('has value [' + candidate[i] + '] more than once at indexes [' + indexes.join(', ') + ']', null, 'uniqueness');\r\n        }\r\n      }\r\n    },\r\n    pattern: function (schema, candidate) {\r\n      var self = this;\r\n      var regexs = schema.pattern;\r\n      if (typeof candidate !== 'string') {\r\n        return;\r\n      }\r\n      var matches = false;\r\n      if (!_typeIs.array(regexs)) {\r\n        regexs = [regexs];\r\n      }\r\n      regexs.forEach(function (regex) {\r\n        if (typeof regex === 'string' && regex in _formats) {\r\n          regex = _formats[regex];\r\n        }\r\n        if (regex instanceof RegExp) {\r\n          if (regex.test(candidate)) {\r\n            matches = true;\r\n          }\r\n        }\r\n      });\r\n      if (!matches) {\r\n        self.report('must match [' + regexs.join(' or ') + '], but is equal to \"' + candidate + '\"', null, 'pattern');\r\n      }\r\n    },\r\n    validDate: function (schema, candidate) {\r\n      if (String(schema.validDate) === 'true' && candidate instanceof Date && isNaN(candidate.getTime())) {\r\n        this.report('must be a valid date', null, 'validDate');\r\n      }\r\n    },\r\n    minLength: function (schema, candidate) {\r\n      if (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\r\n        return;\r\n      }\r\n      var minLength = Number(schema.minLength);\r\n      if (isNaN(minLength)) {\r\n        return;\r\n      }\r\n      if (candidate.length < minLength) {\r\n        this.report('must be longer than ' + minLength + ' elements, but it has ' + candidate.length, null, 'minLength');\r\n      }\r\n    },\r\n    maxLength: function (schema, candidate) {\r\n      if (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\r\n        return;\r\n      }\r\n      var maxLength = Number(schema.maxLength);\r\n      if (isNaN(maxLength)) {\r\n        return;\r\n      }\r\n      if (candidate.length > maxLength) {\r\n        this.report('must be shorter than ' + maxLength + ' elements, but it has ' + candidate.length, null, 'maxLength');\r\n      }\r\n    },\r\n    exactLength: function (schema, candidate) {\r\n      if (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\r\n        return;\r\n      }\r\n      var exactLength = Number(schema.exactLength);\r\n      if (isNaN(exactLength)) {\r\n        return;\r\n      }\r\n      if (candidate.length !== exactLength) {\r\n        this.report('must have exactly ' + exactLength + ' elements, but it have ' + candidate.length, null, 'exactLength');\r\n      }\r\n    },\r\n    lt: function (schema, candidate) {\r\n      var limit = Number(schema.lt);\r\n      if (typeof candidate !== 'number' || isNaN(limit)) {\r\n        return;\r\n      }\r\n      if (candidate >= limit) {\r\n        this.report('must be less than ' + limit + ', but is equal to \"' + candidate + '\"', null, 'lt');\r\n      }\r\n    },\r\n    lte: function (schema, candidate) {\r\n      var limit = Number(schema.lte);\r\n      if (typeof candidate !== 'number' || isNaN(limit)) {\r\n        return;\r\n      }\r\n      if (candidate > limit) {\r\n        this.report('must be less than or equal to ' + limit + ', but is equal to \"' + candidate + '\"', null, 'lte');\r\n      }\r\n    },\r\n    gt: function (schema, candidate) {\r\n      var limit = Number(schema.gt);\r\n      if (typeof candidate !== 'number' || isNaN(limit)) {\r\n        return;\r\n      }\r\n      if (candidate <= limit) {\r\n        this.report('must be greater than ' + limit + ', but is equal to \"' + candidate + '\"', null, 'gt');\r\n      }\r\n    },\r\n    gte: function (schema, candidate) {\r\n      var limit = Number(schema.gte);\r\n      if (typeof candidate !== 'number' || isNaN(limit)) {\r\n        return;\r\n      }\r\n      if (candidate < limit) {\r\n        this.report('must be greater than or equal to ' + limit + ', but is equal to \"' + candidate + '\"', null, 'gte');\r\n      }\r\n    },\r\n    eq: function (schema, candidate) {\r\n      if (typeof candidate !== 'number' && typeof candidate !== 'string' && typeof candidate !== 'boolean') {\r\n        return;\r\n      }\r\n      var limit = schema.eq;\r\n      if (typeof limit !== 'number' && typeof limit !== 'string' && typeof limit !== 'boolean' && !_typeIs.array(limit)) {\r\n        return;\r\n      }\r\n      if (_typeIs.array(limit)) {\r\n        for (var i = 0; i < limit.length; i++) {\r\n          if (candidate === limit[i]) {\r\n            return;\r\n          }\r\n        }\r\n        this.report('must be equal to [' + limit.map(function (l) {\r\n          return '\"' + l + '\"';\r\n        }).join(' or ') + '], but is equal to \"' + candidate + '\"', null, 'eq');\r\n      } else {\r\n        if (candidate !== limit) {\r\n          this.report('must be equal to \"' + limit + '\", but is equal to \"' + candidate + '\"', null, 'eq');\r\n        }\r\n      }\r\n    },\r\n    ne: function (schema, candidate) {\r\n      if (typeof candidate !== 'number' && typeof candidate !== 'string') {\r\n        return;\r\n      }\r\n      var limit = schema.ne;\r\n      if (typeof limit !== 'number' && typeof limit !== 'string' && !_typeIs.array(limit)) {\r\n        return;\r\n      }\r\n      if (_typeIs.array(limit)) {\r\n        for (var i = 0; i < limit.length; i++) {\r\n          if (candidate === limit[i]) {\r\n            this.report('must not be equal to \"' + limit[i] + '\"', null, 'ne');\r\n            return;\r\n          }\r\n        }\r\n      } else {\r\n        if (candidate === limit) {\r\n          this.report('must not be equal to \"' + limit + '\"', null, 'ne');\r\n        }\r\n      }\r\n    },\r\n    multipleOf: function (schema, candidate) {\r\n      const divisor = Number(schema.multipleOf);\r\n      if (typeof candidate !== 'number' || isNaN(divisor)) {\r\n        return;\r\n      }\r\n      if (candidate % divisor !== 0) {\r\n        this.report(candidate + ' is not divisible by ' + divisor, null, 'multipleOf');\r\n      }\r\n    },\r\n    someKeys: function (schema, candidat) {\r\n      var _keys = schema.someKeys;\r\n      if (!_typeIs.object(candidat)) {\r\n        return;\r\n      }\r\n      var valid = _keys.some(function (action) {\r\n        return (action in candidat);\r\n      });\r\n      if (!valid) {\r\n        this.report('must have at least key ' + _keys.map(function (i) {\r\n          return '\"' + i + '\"';\r\n        }).join(' or '), null, 'someKeys');\r\n      }\r\n    },\r\n    strict: function (schema, candidate) {\r\n      if (typeof schema.strict === 'string') { schema.strict = (schema.strict === 'true'); }\r\n      if (schema.strict !== true || !_typeIs.object(candidate) || !_typeIs.object(schema.properties)) {\r\n        return;\r\n      }\r\n      var self = this;\r\n      if (typeof schema.properties['*'] === 'undefined') {\r\n        var intruder = Object.keys(candidate).filter(function (key) {\r\n          return (typeof schema.properties[key] === 'undefined');\r\n        });\r\n        if (intruder.length > 0) {\r\n          var msg = 'should not contains ' + (intruder.length > 1 ? 'properties' : 'property') +\r\n            ' [' + intruder.map(function (i) { return '\"' + i + '\"'; }).join(', ') + ']';\r\n          self.report(msg, null, 'strict');\r\n        }\r\n      }\r\n    },\r\n    exec: function (schema, candidate, callback) {\r\n      var self = this;\r\n\r\n      if (typeof callback === 'function') {\r\n        return this.asyncExec(schema, candidate, callback);\r\n      }\r\n      (_typeIs.array(schema.exec) ? schema.exec : [schema.exec]).forEach(function (exec) {\r\n        if (typeof exec === 'function') {\r\n          exec.call(self, schema, candidate);\r\n        }\r\n      });\r\n    },\r\n    properties: function (schema, candidate, callback) {\r\n      if (typeof callback === 'function') {\r\n        return this.asyncProperties(schema, candidate, callback);\r\n      }\r\n      if (!(schema.properties instanceof Object) || !(candidate instanceof Object)) {\r\n        return;\r\n      }\r\n      var properties = schema.properties;\r\n      var i;\r\n      if (properties['*'] != null) {\r\n        for (i in candidate) {\r\n          if (i in properties) {\r\n            continue;\r\n          }\r\n          this._deeperObject(i);\r\n          this._validate(properties['*'], candidate[i]);\r\n          this._back();\r\n        }\r\n      }\r\n      for (i in properties) {\r\n        if (i === '*') {\r\n          continue;\r\n        }\r\n        this._deeperObject(i);\r\n        this._validate(properties[i], candidate[i]);\r\n        this._back();\r\n      }\r\n    },\r\n    items: function (schema, candidate, callback) {\r\n      if (typeof callback === 'function') {\r\n        return this.asyncItems(schema, candidate, callback);\r\n      }\r\n      if (!(schema.items instanceof Object) || !(candidate instanceof Object)) {\r\n        return;\r\n      }\r\n      var items = schema.items;\r\n      var i, l;\r\n      // If provided schema is an array\r\n      // then call validate for each case\r\n      // else it is an Object\r\n      // then call validate for each key\r\n      if (_typeIs.array(items) && _typeIs.array(candidate)) {\r\n        for (i = 0, l = items.length; i < l; i++) {\r\n          this._deeperArray(i);\r\n          this._validate(items[i], candidate[i]);\r\n          this._back();\r\n        }\r\n      } else {\r\n        for (var key in candidate) {\r\n          if (Object.prototype.hasOwnProperty.call(candidate, key)) {\r\n            this._deeperArray(key);\r\n            this._validate(items, candidate[key]);\r\n            this._back();\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  var _asyncValidationAttribut = {\r\n    asyncExec: function (schema, candidate, callback) {\r\n      var self = this;\r\n      async.eachSeries(_typeIs.array(schema.exec) ? schema.exec : [schema.exec], function (exec, done) {\r\n        if (typeof exec === 'function') {\r\n          if (exec.length > 2) {\r\n            return exec.call(self, schema, candidate, done);\r\n          }\r\n          exec.call(self, schema, candidate);\r\n        }\r\n        async.nextTick(done);\r\n      }, callback);\r\n    },\r\n    asyncProperties: function (schema, candidate, callback) {\r\n      if (!(schema.properties instanceof Object) || !_typeIs.object(candidate)) {\r\n        return callback();\r\n      }\r\n      var self = this;\r\n      var properties = schema.properties;\r\n      async.series([\r\n        function (next) {\r\n          if (properties['*'] == null) {\r\n            return next();\r\n          }\r\n          async.eachSeries(Object.keys(candidate), function (i, done) {\r\n            if (i in properties) {\r\n              return async.nextTick(done);\r\n            }\r\n            self._deeperObject(i);\r\n            self._asyncValidate(properties['*'], candidate[i], function (err) {\r\n              self._back();\r\n              done(err);\r\n            });\r\n          }, next);\r\n        },\r\n        function (next) {\r\n          async.eachSeries(Object.keys(properties), function (i, done) {\r\n            if (i === '*') {\r\n              return async.nextTick(done);\r\n            }\r\n            self._deeperObject(i);\r\n            self._asyncValidate(properties[i], candidate[i], function (err) {\r\n              self._back();\r\n              done(err);\r\n            });\r\n          }, next);\r\n        }\r\n      ], callback);\r\n    },\r\n    asyncItems: function (schema, candidate, callback) {\r\n      if (!(schema.items instanceof Object) || !(candidate instanceof Object)) {\r\n        return callback();\r\n      }\r\n      var self = this;\r\n      var items = schema.items;\r\n\r\n      if (_typeIs.array(items) && _typeIs.array(candidate)) {\r\n        async.timesSeries(items.length, function (i, done) {\r\n          self._deeperArray(i);\r\n          self._asyncValidate(items[i], candidate[i], function (err, res) {\r\n            self._back();\r\n            done(err, res);\r\n          });\r\n          self._back();\r\n        }, callback);\r\n      } else {\r\n        async.eachSeries(Object.keys(candidate), function (key, done) {\r\n          self._deeperArray(key);\r\n          self._asyncValidate(items, candidate[key], function (err, res) {\r\n            self._back();\r\n            done(err, res);\r\n          });\r\n        }, callback);\r\n      }\r\n    }\r\n  };\r\n\r\n  // Validation Class ----------------------------------------------------------\r\n  // inherits from Inspection class (actually we just call Inspection\r\n  // constructor with the new context, because its prototype is empty\r\n  function Validation(schema, custom) {\r\n    Inspection.prototype.constructor.call(this, schema, _merge(Validation.custom, custom));\r\n    var _error = [];\r\n\r\n    this._basicFields = Object.keys(_validationAttribut);\r\n    this._customFields = Object.keys(this._custom);\r\n    this.origin = null;\r\n\r\n    this.report = function (message, code, reason) {\r\n      var newErr = {\r\n        code: code || this.userCode || null,\r\n        reason: reason || 'unknown',\r\n        message: this.userError || message || 'is invalid',\r\n        property: this.userAlias ? (this.userAlias + ' (' + this._dumpStack() + ')') : this._dumpStack()\r\n      };\r\n      _error.push(newErr);\r\n      return this;\r\n    };\r\n\r\n    this.result = function () {\r\n      return {\r\n        error: _error,\r\n        valid: _error.length === 0,\r\n        format: function () {\r\n          if (this.valid === true) {\r\n            return 'Candidate is valid';\r\n          }\r\n          return this.error.map(function (i) {\r\n            return 'Property ' + i.property + ': ' + i.message;\r\n          }).join('\\n');\r\n        }\r\n      };\r\n    };\r\n  }\r\n\r\n  _extend(Validation.prototype, _validationAttribut);\r\n  _extend(Validation.prototype, _asyncValidationAttribut);\r\n  _extend(Validation, new Customisable());\r\n\r\n  Validation.prototype.validate = function (candidate, callback) {\r\n    this.origin = candidate;\r\n    if (typeof callback === 'function') {\r\n      var self = this;\r\n      return async.nextTick(function () {\r\n        self._asyncValidate(self._schema, candidate, function (err) {\r\n          self.origin = null;\r\n          callback(err, self.result());\r\n        });\r\n      });\r\n    }\r\n    return this._validate(this._schema, candidate).result();\r\n  };\r\n\r\n  Validation.prototype._validate = function (schema, candidate, callback) {\r\n    this.userCode = schema.code || null;\r\n    this.userError = schema.error || null;\r\n    this.userAlias = schema.alias || null;\r\n    this._basicFields.forEach(function (i) {\r\n      if ((i in schema || i === 'optional') && typeof this[i] === 'function') {\r\n        this[i](schema, candidate);\r\n      }\r\n    }, this);\r\n    this._customFields.forEach(function (i) {\r\n      if (i in schema && typeof this._custom[i] === 'function') {\r\n        this._custom[i].call(this, schema, candidate);\r\n      }\r\n    }, this);\r\n    return this;\r\n  };\r\n\r\n  Validation.prototype._asyncValidate = function (schema, candidate, callback) {\r\n    var self = this;\r\n    this.userCode = schema.code || null;\r\n    this.userError = schema.error || null;\r\n    this.userAlias = schema.alias || null;\r\n\r\n    async.series([\r\n      function (next) {\r\n        async.eachSeries(Object.keys(_validationAttribut), function (i, done) {\r\n          async.nextTick(function () {\r\n            if ((i in schema || i === 'optional') && typeof self[i] === 'function') {\r\n              if (self[i].length > 2) {\r\n                return self[i](schema, candidate, done);\r\n              }\r\n              self[i](schema, candidate);\r\n            }\r\n            done();\r\n          });\r\n        }, next);\r\n      },\r\n      function (next) {\r\n        async.eachSeries(Object.keys(self._custom), function (i, done) {\r\n          async.nextTick(function () {\r\n            if (i in schema && typeof self._custom[i] === 'function') {\r\n              if (self._custom[i].length > 2) {\r\n                return self._custom[i].call(self, schema, candidate, done);\r\n              }\r\n              self._custom[i].call(self, schema, candidate);\r\n            }\r\n            done();\r\n          });\r\n        }, next);\r\n      }\r\n    ], callback);\r\n  };\r\n\r\n  // Sanitization ----------------------------------------------------------------\r\n  // functions called by _sanitization.type method.\r\n  var _forceType = {\r\n    number: function (post, schema) {\r\n      var n;\r\n      if (typeof post === 'number') {\r\n        return post;\r\n      } else if (post === '') {\r\n        if (typeof schema.def !== 'undefined') {\r\n          return schema.def;\r\n        }\r\n        return null;\r\n      } else if (typeof post === 'string') {\r\n        n = parseFloat(post.replace(/,/g, '.').replace(/ /g, ''));\r\n        if (typeof n === 'number') {\r\n          return n;\r\n        }\r\n      } else if (post instanceof Date) {\r\n        return +post;\r\n      }\r\n      return null;\r\n    },\r\n    integer: function (post, schema) {\r\n      var n;\r\n      if (typeof post === 'number' && post % 1 === 0) {\r\n        return post;\r\n      } else if (post === '') {\r\n        if (typeof schema.def !== 'undefined') {\r\n          return schema.def;\r\n        }\r\n        return null;\r\n      } else if (typeof post === 'string') {\r\n        n = parseInt(post.replace(/ /g, ''), 10);\r\n        if (typeof n === 'number') {\r\n          return n;\r\n        }\r\n      } else if (typeof post === 'number') {\r\n        return parseInt(post, 10);\r\n      } else if (typeof post === 'boolean') {\r\n        if (post) { return 1; }\r\n        return 0;\r\n      } else if (post instanceof Date) {\r\n        return +post;\r\n      }\r\n      return null;\r\n    },\r\n    string: function (post, schema) {\r\n      if (typeof post === 'boolean' || typeof post === 'number' || post instanceof Date) {\r\n        return post.toString();\r\n      } else if (_typeIs.array(post)) {\r\n        // If user authorize array and strings...\r\n        if (schema.items || schema.properties) {\r\n          return post;\r\n        }\r\n        return post.join(String(schema.joinWith || ','));\r\n      } else if (post instanceof Object) {\r\n        // If user authorize objects ans strings...\r\n        if (schema.items || schema.properties) {\r\n          return post;\r\n        }\r\n        return JSON.stringify(post);\r\n      } else if (typeof post === 'string' && post.length) {\r\n        return post;\r\n      }\r\n      return null;\r\n    },\r\n    date: function (post, schema) {\r\n      if (post instanceof Date) {\r\n        return post;\r\n      } else {\r\n        var d = new Date(post);\r\n        if (!isNaN(d.getTime())) { // if valid date\r\n          return d;\r\n        }\r\n      }\r\n      return null;\r\n    },\r\n    boolean: function (post, schema) {\r\n      if (typeof post === 'undefined') return null;\r\n      if (typeof post === 'string' && post.toLowerCase() === 'false') return false;\r\n      return !!post;\r\n    },\r\n    object: function (post, schema) {\r\n      if (typeof post !== 'string' || _typeIs.object(post)) {\r\n        return post;\r\n      }\r\n      try {\r\n        return JSON.parse(post);\r\n      } catch (e) {\r\n        return null;\r\n      }\r\n    },\r\n    array: function (post, schema) {\r\n      if (_typeIs.array(post)) {\r\n        return post;\r\n      }\r\n      if (typeof post === 'undefined') {\r\n        return null;\r\n      }\r\n      if (typeof post === 'string') {\r\n        if (post.substring(0, 1) === '[' && post.slice(-1) === ']') {\r\n          try {\r\n            return JSON.parse(post);\r\n          } catch (e) {\r\n            return null;\r\n          }\r\n        }\r\n        return post.split(String(schema.splitWith || ','));\r\n      }\r\n      if (!_typeIs.array(post)) {\r\n        return [post];\r\n      }\r\n      return null;\r\n    }\r\n  };\r\n\r\n  var _applyRules = {\r\n    upper: function (post) {\r\n      return post.toUpperCase();\r\n    },\r\n    lower: function (post) {\r\n      return post.toLowerCase();\r\n    },\r\n    title: function (post) {\r\n      // Fix by seb (replace \\w\\S* by \\S* => exemple : coucou Ã§a va)\r\n      return post.replace(/\\S*/g, function (txt) {\r\n        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\r\n      });\r\n    },\r\n    capitalize: function (post) {\r\n      return post.charAt(0).toUpperCase() + post.substr(1).toLowerCase();\r\n    },\r\n    ucfirst: function (post) {\r\n      return post.charAt(0).toUpperCase() + post.substr(1);\r\n    },\r\n    trim: function (post) {\r\n      return post.trim();\r\n    }\r\n  };\r\n\r\n  // Every function return the future value of each property. Therefore you\r\n  // have to return post even if you do not change its value\r\n  var _sanitizationAttribut = {\r\n    strict: function (schema, post) {\r\n      if (typeof schema.strict === 'string') { schema.strict = (schema.strict === 'true'); }\r\n      if (schema.strict !== true) {\r\n        return post;\r\n      }\r\n      if (!_typeIs.object(schema.properties)) {\r\n        return post;\r\n      }\r\n      if (!_typeIs.object(post)) {\r\n        return post;\r\n      }\r\n      Object.keys(post).forEach(function (key) {\r\n        if (!(key in schema.properties)) {\r\n          delete post[key];\r\n        }\r\n      });\r\n      return post;\r\n    },\r\n    optional: function (schema, post) {\r\n      var opt = typeof schema.optional === 'boolean' ? schema.optional : (schema.optional !== 'false'); // Default: true\r\n      if (opt === true) {\r\n        return post;\r\n      }\r\n      if (typeof post !== 'undefined') {\r\n        return post;\r\n      }\r\n      this.report();\r\n      if (schema.def === Date) {\r\n        return new Date();\r\n      }\r\n      return schema.def;\r\n    },\r\n    type: function (schema, post) {\r\n      // if (_typeIs['object'](post) || _typeIs.array(post)) {\r\n      //   return post;\r\n      // }\r\n      if (typeof schema.type !== 'string' || typeof _forceType[schema.type] !== 'function') {\r\n        return post;\r\n      }\r\n      var n;\r\n      var opt = typeof schema.optional === 'boolean' ? schema.optional : true;\r\n      if (typeof _forceType[schema.type] === 'function') {\r\n        n = _forceType[schema.type](post, schema);\r\n        if ((n === null && !opt) || (!n && isNaN(n)) || (n === null && schema.type === 'string')) {\r\n          n = schema.def;\r\n        }\r\n      } else if (!opt) {\r\n        n = schema.def;\r\n      }\r\n      if ((n != null || (typeof schema.def !== 'undefined' && schema.def === n)) && n !== post) {\r\n        this.report();\r\n        return n;\r\n      }\r\n      return post;\r\n    },\r\n    rules: function (schema, post) {\r\n      var rules = schema.rules;\r\n      if (typeof post !== 'string' || (typeof rules !== 'string' && !_typeIs.array(rules))) {\r\n        return post;\r\n      }\r\n      var modified = false;\r\n      (_typeIs.array(rules) ? rules : [rules]).forEach(function (rule) {\r\n        if (typeof _applyRules[rule] === 'function') {\r\n          post = _applyRules[rule](post);\r\n          modified = true;\r\n        }\r\n      });\r\n      if (modified) {\r\n        this.report();\r\n      }\r\n      return post;\r\n    },\r\n    min: function (schema, post) {\r\n      var postTest = Number(post);\r\n      if (isNaN(postTest)) {\r\n        return post;\r\n      }\r\n      var min = Number(schema.min);\r\n      if (isNaN(min)) {\r\n        return post;\r\n      }\r\n      if (postTest < min) {\r\n        this.report();\r\n        return min;\r\n      }\r\n      return post;\r\n    },\r\n    max: function (schema, post) {\r\n      var postTest = Number(post);\r\n      if (isNaN(postTest)) {\r\n        return post;\r\n      }\r\n      var max = Number(schema.max);\r\n      if (isNaN(max)) {\r\n        return post;\r\n      }\r\n      if (postTest > max) {\r\n        this.report();\r\n        return max;\r\n      }\r\n      return post;\r\n    },\r\n    minLength: function (schema, post) {\r\n      var limit = Number(schema.minLength);\r\n      if (typeof post !== 'string' || isNaN(limit) || limit < 0) {\r\n        return post;\r\n      }\r\n      var str = '';\r\n      var gap = limit - post.length;\r\n      if (gap > 0) {\r\n        for (var i = 0; i < gap; i++) {\r\n          str += '-';\r\n        }\r\n        this.report();\r\n        return post + str;\r\n      }\r\n      return post;\r\n    },\r\n    maxLength: function (schema, post) {\r\n      var limit = Number(schema.maxLength);\r\n      if (typeof post !== 'string' || isNaN(limit) || limit < 0) {\r\n        return post;\r\n      }\r\n      if (post.length > limit) {\r\n        this.report();\r\n        return post.slice(0, limit);\r\n      }\r\n      return post;\r\n    },\r\n    properties: function (schema, post, callback) {\r\n      if (typeof callback === 'function') {\r\n        return this.asyncProperties(schema, post, callback);\r\n      }\r\n      if (!post || typeof post !== 'object') {\r\n        return post;\r\n      }\r\n      var properties = schema.properties;\r\n      var tmp;\r\n      var i;\r\n      if (typeof properties['*'] !== 'undefined') {\r\n        for (i in post) {\r\n          if (i in properties) {\r\n            continue;\r\n          }\r\n          this._deeperObject(i);\r\n          tmp = this._sanitize(properties['*'], post[i]);\r\n          if (typeof tmp !== 'undefined' || 'exec' in properties['*']) {\r\n            post[i] = tmp;\r\n          }\r\n          this._back();\r\n        }\r\n      }\r\n      for (i in properties) {\r\n        if (i !== '*') {\r\n          this._deeperObject(i);\r\n          tmp = this._sanitize(properties[i], post[i]);\r\n          if (typeof tmp !== 'undefined' || 'exec' in properties[i]) {\r\n            post[i] = tmp;\r\n          }\r\n          this._back();\r\n        }\r\n      }\r\n      return post;\r\n    },\r\n    items: function (schema, post, callback) {\r\n      if (typeof callback === 'function') {\r\n        return this.asyncItems(schema, post, callback);\r\n      }\r\n      if (!(schema.items instanceof Object) || !(post instanceof Object)) {\r\n        return post;\r\n      }\r\n      var i;\r\n      if (_typeIs.array(schema.items) && _typeIs.array(post)) {\r\n        var minLength = schema.items.length < post.length ? schema.items.length : post.length;\r\n        for (i = 0; i < minLength; i++) {\r\n          this._deeperArray(i);\r\n          post[i] = this._sanitize(schema.items[i], post[i]);\r\n          this._back();\r\n        }\r\n      } else {\r\n        for (i in post) {\r\n          if (Object.prototype.hasOwnProperty.call(post, i)) {\r\n            this._deeperArray(i);\r\n            post[i] = this._sanitize(schema.items, post[i]);\r\n            this._back();\r\n          }\r\n        }\r\n      }\r\n      return post;\r\n    },\r\n    exec: function (schema, post, callback) {\r\n      if (typeof callback === 'function') {\r\n        return this.asyncExec(schema, post, callback);\r\n      }\r\n      var execs = _typeIs.array(schema.exec) ? schema.exec : [schema.exec];\r\n\r\n      execs.forEach(function (exec) {\r\n        if (typeof exec === 'function') {\r\n          post = exec.call(this, schema, post);\r\n        }\r\n      }, this);\r\n      return post;\r\n    }\r\n  };\r\n\r\n  var _asyncSanitizationAttribut = {\r\n    asyncExec: function (schema, post, callback) {\r\n      var self = this;\r\n      var execs = _typeIs.array(schema.exec) ? schema.exec : [schema.exec];\r\n\r\n      async.eachSeries(execs, function (exec, done) {\r\n        if (typeof exec === 'function') {\r\n          if (exec.length > 2) {\r\n            return exec.call(self, schema, post, function (err, res) {\r\n              if (err) {\r\n                return done(err);\r\n              }\r\n              post = res;\r\n              done();\r\n            });\r\n          }\r\n          post = exec.call(self, schema, post);\r\n        }\r\n        done();\r\n      }, function (err) {\r\n        callback(err, post);\r\n      });\r\n    },\r\n    asyncProperties: function (schema, post, callback) {\r\n      if (!post || typeof post !== 'object') {\r\n        return callback(null, post);\r\n      }\r\n      var self = this;\r\n      var properties = schema.properties;\r\n\r\n      async.series([\r\n        function (next) {\r\n          if (properties['*'] == null) {\r\n            return next();\r\n          }\r\n          var globing = properties['*'];\r\n          async.eachSeries(Object.keys(post), function (i, next) {\r\n            if (i in properties) {\r\n              return next();\r\n            }\r\n            self._deeperObject(i);\r\n            self._asyncSanitize(globing, post[i], function (err, res) {\r\n              if (err) { /* Error can safely be ignored here */ }\r\n              if (typeof res !== 'undefined') {\r\n                post[i] = res;\r\n              }\r\n              self._back();\r\n              next();\r\n            });\r\n          }, next);\r\n        },\r\n        function (next) {\r\n          async.eachSeries(Object.keys(properties), function (i, next) {\r\n            if (i === '*') {\r\n              return next();\r\n            }\r\n            self._deeperObject(i);\r\n            self._asyncSanitize(properties[i], post[i], function (err, res) {\r\n              if (err) {\r\n                return next(err);\r\n              }\r\n              if (typeof res !== 'undefined') {\r\n                post[i] = res;\r\n              }\r\n              self._back();\r\n              next();\r\n            });\r\n          }, next);\r\n        }\r\n      ], function (err) {\r\n        return callback(err, post);\r\n      });\r\n    },\r\n    asyncItems: function (schema, post, callback) {\r\n      if (!(schema.items instanceof Object) || !(post instanceof Object)) {\r\n        return callback(null, post);\r\n      }\r\n      var self = this;\r\n      var items = schema.items;\r\n      if (_typeIs.array(items) && _typeIs.array(post)) {\r\n        var minLength = items.length < post.length ? items.length : post.length;\r\n        async.timesSeries(minLength, function (i, next) {\r\n          self._deeperArray(i);\r\n          self._asyncSanitize(items[i], post[i], function (err, res) {\r\n            if (err) {\r\n              return next(err);\r\n            }\r\n            post[i] = res;\r\n            self._back();\r\n            next();\r\n          });\r\n        }, function (err) {\r\n          callback(err, post);\r\n        });\r\n      } else {\r\n        async.eachSeries(Object.keys(post), function (key, next) {\r\n          self._deeperArray(key);\r\n          self._asyncSanitize(items, post[key], function (err, res) {\r\n            if (err) {\r\n              return next();\r\n            }\r\n            post[key] = res;\r\n            self._back();\r\n            next();\r\n          });\r\n        }, function (err) {\r\n          callback(err, post);\r\n        });\r\n      }\r\n      return post;\r\n    }\r\n  };\r\n\r\n  // Sanitization Class --------------------------------------------------------\r\n  // inherits from Inspection class (actually we just call Inspection\r\n  // constructor with the new context, because its prototype is empty\r\n  function Sanitization(schema, custom) {\r\n    Inspection.prototype.constructor.call(this, schema, _merge(Sanitization.custom, custom));\r\n    var _reporting = [];\r\n\r\n    this._basicFields = Object.keys(_sanitizationAttribut);\r\n    this._customFields = Object.keys(this._custom);\r\n    this.origin = null;\r\n\r\n    this.report = function (message) {\r\n      var newNot = {\r\n        message: message || 'was sanitized',\r\n        property: this.userAlias ? (this.userAlias + ' (' + this._dumpStack() + ')') : this._dumpStack()\r\n      };\r\n      if (!_reporting.some(function (e) { return e.property === newNot.property; })) {\r\n        _reporting.push(newNot);\r\n      }\r\n    };\r\n\r\n    this.result = function (data) {\r\n      // For old IE.\r\n      /* eslint-disable object-shorthand */\r\n      return {\r\n        data: data,\r\n        reporting: _reporting,\r\n        format: function () {\r\n          return this.reporting.map(function (i) {\r\n            return 'Property ' + i.property + ' ' + i.message;\r\n          }).join('\\n');\r\n        }\r\n      };\r\n      /* eslint-enable object-shorthand */\r\n    };\r\n  }\r\n\r\n  _extend(Sanitization.prototype, _sanitizationAttribut);\r\n  _extend(Sanitization.prototype, _asyncSanitizationAttribut);\r\n  _extend(Sanitization, new Customisable());\r\n\r\n  Sanitization.prototype.sanitize = function (post, callback) {\r\n    this.origin = post;\r\n    if (typeof callback === 'function') {\r\n      var self = this;\r\n      return this._asyncSanitize(this._schema, post, function (err, data) {\r\n        self.origin = null;\r\n        callback(err, self.result(data));\r\n      });\r\n    }\r\n    var data = this._sanitize(this._schema, post);\r\n    this.origin = null;\r\n    return this.result(data);\r\n  };\r\n\r\n  Sanitization.prototype._sanitize = function (schema, post) {\r\n    this.userAlias = schema.alias || null;\r\n    this._basicFields.forEach(function (i) {\r\n      if ((i in schema || i === 'optional') && typeof this[i] === 'function') {\r\n        post = this[i](schema, post);\r\n      }\r\n    }, this);\r\n    this._customFields.forEach(function (i) {\r\n      if (i in schema && typeof this._custom[i] === 'function') {\r\n        post = this._custom[i].call(this, schema, post);\r\n      }\r\n    }, this);\r\n    return post;\r\n  };\r\n\r\n  Sanitization.prototype._asyncSanitize = function (schema, post, callback) {\r\n    var self = this;\r\n    this.userAlias = schema.alias || null;\r\n\r\n    async.waterfall([\r\n      function (next) {\r\n        async.reduce(self._basicFields, post, function (value, i, next) {\r\n          async.nextTick(function () {\r\n            if ((i in schema || i === 'optional') && typeof self[i] === 'function') {\r\n              if (self[i].length > 2) {\r\n                return self[i](schema, value, next);\r\n              }\r\n              value = self[i](schema, value);\r\n            }\r\n            next(null, value);\r\n          });\r\n        }, next);\r\n      },\r\n      function (inter, next) {\r\n        async.reduce(self._customFields, inter, function (value, i, next) {\r\n          async.nextTick(function () {\r\n            if (i in schema && typeof self._custom[i] === 'function') {\r\n              if (self._custom[i].length > 2) {\r\n                return self._custom[i].call(self, schema, value, next);\r\n              }\r\n              value = self._custom[i].call(self, schema, value);\r\n            }\r\n            next(null, value);\r\n          });\r\n        }, next);\r\n      }\r\n    ], callback);\r\n  };\r\n\r\n  // ---------------------------------------------------------------------------\r\n\r\n  var INT_MIN = -2147483648;\r\n  var INT_MAX = 2147483647;\r\n\r\n  var _rand = {\r\n    int: function (min, max) {\r\n      return min + (0 | Math.random() * (max - min + 1));\r\n    },\r\n    float: function (min, max) {\r\n      return (Math.random() * (max - min) + min);\r\n    },\r\n    bool: function () {\r\n      return (Math.random() > 0.5);\r\n    },\r\n    char: function (min, max) {\r\n      return String.fromCharCode(this.int(min, max));\r\n    },\r\n    fromList: function (list) {\r\n      return list[this.int(0, list.length - 1)];\r\n    }\r\n  };\r\n\r\n  var _formatSample = {\r\n    'date-time': function () {\r\n      return new Date().toISOString();\r\n    },\r\n    date: function () {\r\n      return new Date().toISOString().replace(/T.*$/, '');\r\n    },\r\n    time: function () {\r\n      return new Date().toLocaleTimeString({}, { hour12: false });\r\n    },\r\n    color: function (min, max) {\r\n      var s = '#';\r\n      if (min < 1) {\r\n        min = 1;\r\n      }\r\n      for (var i = 0, l = _rand.int(min, max); i < l; i++) {\r\n        s += _rand.fromList('0123456789abcdefABCDEF');\r\n      }\r\n      return s;\r\n    },\r\n    numeric: function () {\r\n      return '' + _rand.int(0, INT_MAX);\r\n    },\r\n    integer: function () {\r\n      if (_rand.bool() === true) {\r\n        return '-' + this.numeric();\r\n      }\r\n      return this.numeric();\r\n    },\r\n    decimal: function () {\r\n      return this.integer() + '.' + this.numeric();\r\n    },\r\n    alpha: function (min, max) {\r\n      var s = '';\r\n      if (min < 1) {\r\n        min = 1;\r\n      }\r\n      for (var i = 0, l = _rand.int(min, max); i < l; i++) {\r\n        s += _rand.fromList('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ');\r\n      }\r\n      return s;\r\n    },\r\n    alphaNumeric: function (min, max) {\r\n      var s = '';\r\n      if (min < 1) {\r\n        min = 1;\r\n      }\r\n      for (var i = 0, l = _rand.int(min, max); i < l; i++) {\r\n        s += _rand.fromList('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789');\r\n      }\r\n      return s;\r\n    },\r\n    alphaDash: function (min, max) {\r\n      var s = '';\r\n      if (min < 1) {\r\n        min = 1;\r\n      }\r\n      for (var i = 0, l = _rand.int(min, max); i < l; i++) {\r\n        s += _rand.fromList('_-abcdefghijklmnopqrstuvwxyz_-ABCDEFGHIJKLMNOPQRSTUVWXYZ_-0123456789_-');\r\n      }\r\n      return s;\r\n    },\r\n    javascript: function (min, max) {\r\n      var s = _rand.fromList('_$abcdefghijklmnopqrstuvwxyz_$ABCDEFGHIJKLMNOPQRSTUVWXYZ_$');\r\n      for (var i = 0, l = _rand.int(min, max - 1); i < l; i++) {\r\n        s += _rand.fromList('_$abcdefghijklmnopqrstuvwxyz_$ABCDEFGHIJKLMNOPQRSTUVWXYZ_$0123456789_$');\r\n      }\r\n      return s;\r\n    }\r\n  };\r\n\r\n  function _getLimits(schema) {\r\n    var min = INT_MIN;\r\n    var max = INT_MAX;\r\n\r\n    if (schema.gte != null) {\r\n      min = schema.gte;\r\n    } else if (schema.gt != null) {\r\n      min = schema.gt + 1;\r\n    }\r\n    if (schema.lte != null) {\r\n      max = schema.lte;\r\n    } else if (schema.lt != null) {\r\n      max = schema.lt - 1;\r\n    }\r\n    // For old IE.\r\n    /* eslint-disable object-shorthand */\r\n    return { min: min, max: max };\r\n    /* eslint-enable object-shorthand */\r\n  }\r\n\r\n  var _typeGenerator = {\r\n    string: function (schema) {\r\n      if (schema.eq != null) {\r\n        return schema.eq;\r\n      }\r\n      var s = '';\r\n      var minLength = schema.minLength != null ? schema.minLength : 0;\r\n      var maxLength = schema.maxLength != null ? schema.maxLength : 32;\r\n      if (typeof schema.pattern === 'string' && typeof _formatSample[schema.pattern] === 'function') {\r\n        return _formatSample[schema.pattern](minLength, maxLength);\r\n      }\r\n\r\n      var l = schema.exactLength != null ? schema.exactLength : _rand.int(minLength, maxLength);\r\n      for (var i = 0; i < l; i++) {\r\n        s += _rand.char(32, 126);\r\n      }\r\n      return s;\r\n    },\r\n    number: function (schema) {\r\n      if (schema.eq != null) {\r\n        return schema.eq;\r\n      }\r\n      var limit = _getLimits(schema);\r\n      var n = _rand.float(limit.min, limit.max);\r\n      if (schema.ne != null) {\r\n        var ne = _typeIs.array(schema.ne) ? schema.ne : [schema.ne];\r\n        while (ne.indexOf(n) !== -1) {\r\n          n = _rand.float(limit.min, limit.max);\r\n        }\r\n      }\r\n      return n;\r\n    },\r\n    integer: function (schema) {\r\n      if (schema.eq != null) {\r\n        return schema.eq;\r\n      }\r\n      var limit = _getLimits(schema);\r\n      var n = _rand.int(limit.min, limit.max);\r\n      if (schema.ne != null) {\r\n        var ne = _typeIs.array(schema.ne) ? schema.ne : [schema.ne];\r\n        while (ne.indexOf(n) !== -1) {\r\n          n = _rand.int(limit.min, limit.max);\r\n        }\r\n      }\r\n      return n;\r\n    },\r\n    boolean: function (schema) {\r\n      if (schema.eq != null) {\r\n        return schema.eq;\r\n      }\r\n      return _rand.bool();\r\n    },\r\n    null: function (schema) {\r\n      return null;\r\n    },\r\n    date: function (schema) {\r\n      if (schema.eq != null) {\r\n        return schema.eq;\r\n      }\r\n      return new Date();\r\n    },\r\n    object: function (schema) {\r\n      var o = {};\r\n      var prop = schema.properties || {};\r\n\r\n      for (var key in prop) {\r\n        if (Object.prototype.hasOwnProperty.call(prop, key)) {\r\n          if (prop[key].optional === true && _rand.bool() === true) {\r\n            continue;\r\n          }\r\n          if (key !== '*') {\r\n            o[key] = this.generate(prop[key]);\r\n          } else {\r\n            var rk = '__random_key_';\r\n            var randomKey = rk + 0;\r\n            var n = _rand.int(1, 9);\r\n            for (var i = 1; i <= n; i++) {\r\n              if (!(randomKey in prop)) {\r\n                o[randomKey] = this.generate(prop[key]);\r\n              }\r\n              randomKey = rk + i;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return o;\r\n    },\r\n    array: function (schema) {\r\n      var self = this;\r\n      var items = schema.items || {};\r\n      var minLength = schema.minLength != null ? schema.minLength : 0;\r\n      var maxLength = schema.maxLength != null ? schema.maxLength : 16;\r\n      var type;\r\n      var candidate;\r\n      var size;\r\n      var i;\r\n\r\n      if (_typeIs.array(items)) {\r\n        size = items.length;\r\n        if (schema.exactLength != null) {\r\n          size = schema.exactLength;\r\n        } else if (size < minLength) {\r\n          size = minLength;\r\n        } else if (size > maxLength) {\r\n          size = maxLength;\r\n        }\r\n        candidate = new Array(size);\r\n        type = null;\r\n        for (i = 0; i < size; i++) {\r\n          type = items[i].type || 'any';\r\n          if (_typeIs.array(type)) {\r\n            type = type[_rand.int(0, type.length - 1)];\r\n          }\r\n          candidate[i] = self[type](items[i]);\r\n        }\r\n      } else {\r\n        size = schema.exactLength != null ? schema.exactLength : _rand.int(minLength, maxLength);\r\n        candidate = new Array(size);\r\n        type = items.type || 'any';\r\n        if (_typeIs.array(type)) {\r\n          type = type[_rand.int(0, type.length - 1)];\r\n        }\r\n        for (i = 0; i < size; i++) {\r\n          candidate[i] = self[type](items);\r\n        }\r\n      }\r\n      return candidate;\r\n    },\r\n    any: function (schema) {\r\n      var fields = Object.keys(_typeGenerator);\r\n      var i = fields[_rand.int(0, fields.length - 2)];\r\n      return this[i](schema);\r\n    }\r\n  };\r\n\r\n  // CandidateGenerator Class (Singleton) --------------------------------------\r\n  function CandidateGenerator() {\r\n    // Maybe extends Inspection class too ?\r\n  }\r\n\r\n  _extend(CandidateGenerator.prototype, _typeGenerator);\r\n\r\n  var _instance = null;\r\n  CandidateGenerator.instance = function () {\r\n    if (!(_instance instanceof CandidateGenerator)) {\r\n      _instance = new CandidateGenerator();\r\n    }\r\n    return _instance;\r\n  };\r\n\r\n  CandidateGenerator.prototype.generate = function (schema) {\r\n    var type = schema.type || 'any';\r\n    if (_typeIs.array(type)) {\r\n      type = type[_rand.int(0, type.length - 1)];\r\n    }\r\n    return this[type](schema);\r\n  };\r\n\r\n  // Exports ---------------------------------------------------------------------\r\n  var SchemaInspector = {};\r\n\r\n  // if server-side (node.js) else client-side\r\n  if (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = SchemaInspector;\r\n  } else {\r\n    window.SchemaInspector = SchemaInspector;\r\n  }\r\n\r\n  SchemaInspector.newSanitization = function (schema, custom) {\r\n    return new Sanitization(schema, custom);\r\n  };\r\n\r\n  SchemaInspector.newValidation = function (schema, custom) {\r\n    return new Validation(schema, custom);\r\n  };\r\n\r\n  SchemaInspector.Validation = Validation;\r\n  SchemaInspector.Sanitization = Sanitization;\r\n\r\n  SchemaInspector.sanitize = function (schema, post, custom, callback) {\r\n    if (arguments.length === 3 && typeof custom === 'function') {\r\n      callback = custom;\r\n      custom = null;\r\n    }\r\n    return new Sanitization(schema, custom).sanitize(post, callback);\r\n  };\r\n\r\n  SchemaInspector.validate = function (schema, candidate, custom, callback) {\r\n    if (arguments.length === 3 && typeof custom === 'function') {\r\n      callback = custom;\r\n      custom = null;\r\n    }\r\n    return new Validation(schema, custom).validate(candidate, callback);\r\n  };\r\n\r\n  SchemaInspector.generate = function (schema, n) {\r\n    if (typeof n === 'number') {\r\n      var r = new Array(n);\r\n      for (var i = 0; i < n; i++) {\r\n        r[i] = CandidateGenerator.instance().generate(schema);\r\n      }\r\n      return r;\r\n    }\r\n    return CandidateGenerator.instance().generate(schema);\r\n  };\r\n})();\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}